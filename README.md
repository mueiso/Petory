# 🐾 PETORY

<div align="center">

<img src="https://github.com/user-attachments/assets/59b15656-0f9a-4e13-a42e-a42bfe842e14" width="70%" />


🐕**반려동물과 함께하는 일상을 더욱 풍요롭게 만드는 웹 플랫폼**🐈‍⬛

[🌐 사이트 바로가기](https://petory.click) | [📖 API 문서](https://documenter.getpostman.com/view/43234443/2sB2xE9ndC) | [🎨 와이어프레임](https://github.com/jhyang22/Petory/wiki/%EC%99%80%EC%9D%B4%EC%96%B4%ED%94%84%EB%A0%88%EC%9E%84-PDF
)
</div>

## 💡 프로젝트 소개

> **"하루 한 번, 반려동물과 더 가까워지는 웹"**

요즘 반려 동물은 '가족'에 포함되는 소중한 존재입니다.

하지만 반려인들은 여전히 **정보 공유**, **소통**, **기록 관리**, **용품 거래** 등 일상 속 다양한 불편함을 겪고 있습니다.

PETORY는 이런 반려인들의 일상을 더 풍요롭게 만들기 위해 탄생한 **소통/거래/기록 통합 플랫폼**입니다.

### 🎯 해결하고자 하는 문제

- 💬 **소통 부족**: 반려인들끼리 경험을 나눌 수 있는 전용 공간이 부족
- ♻️ **거래 불편**: 반려용품 전용 중고 거래 커뮤니티 부족
- 🍽️ **정보 부족**: 반려동물 동반 가능한 장소 정보가 분산되어 있음
- 📸 **기록 관리**: 반려동물과의 소중한 순간들을 체계적으로 관리하기 어려움


## 🛠️ 기술 스택

### Backend
![Java](https://img.shields.io/badge/Java-17-007396?style=for-the-badge&logo=java)
![Spring Boot](https://img.shields.io/badge/Spring%20Boot-3.x-6DB33F?style=for-the-badge&logo=spring)
![Spring Data JPA](https://img.shields.io/badge/Spring%20Data%20JPA-6DB33F?style=for-the-badge&logo=spring)
![Spring Security](https://img.shields.io/badge/Spring%20Security-6DB33F?style=for-the-badge&logo=spring)
![Spring Batch](https://img.shields.io/badge/Spring%20Batch-6DB33F?style=for-the-badge&logo=spring)
![JWT](https://img.shields.io/badge/JWT-000000?style=for-the-badge&logo=jsonwebtokens)
![QueryDSL](https://img.shields.io/badge/QueryDSL-4285F4?style=for-the-badge)
![WebSocket](https://img.shields.io/badge/WebSocket-4285F4?style=for-the-badge)
![STOMP](https://img.shields.io/badge/STOMP-FF6600?style=for-the-badge)
![iCal4j](https://img.shields.io/badge/iCal4j-FF6B35?style=for-the-badge)
![Bucket4J](https://img.shields.io/badge/Bucket4J-00ADD8?style=for-the-badge)

### Database & Storage
![MySQL](https://img.shields.io/badge/MySQL-8.0-4479A1?style=for-the-badge&logo=mysql)
![Redis](https://img.shields.io/badge/Redis-7.0-DC382D?style=for-the-badge&logo=redis)
![MongoDB](https://img.shields.io/badge/MongoDB-Atlas-47A248?style=for-the-badge&logo=mongodb)
![Amazon S3](https://img.shields.io/badge/Amazon%20S3-569A31?style=for-the-badge&logo=amazons3)
![ElastiCache](https://img.shields.io/badge/ElastiCache-FF4F8B?style=for-the-badge&logo=amazon-aws)

### DevOps & Infrastructure
[![Docker](https://img.shields.io/badge/Docker-28.x-2496ED?style=flat-square&logo=docker)](https://www.docker.com/)
![GitHub Actions](https://img.shields.io/badge/GitHub%20Actions-2088FF?style=for-the-badge&logo=github-actions)
![AWS EC2](https://img.shields.io/badge/AWS%20EC2-FF9900?style=for-the-badge&logo=amazon-aws)
![ECR](https://img.shields.io/badge/Amazon%20ECR-FF9900?style=for-the-badge&logo=amazon-aws)
![Route53](https://img.shields.io/badge/Amazon%20Route53-FF9900?style=for-the-badge&logo=amazon-aws)

### Test & Monitoring
![Postman](https://img.shields.io/badge/Postman-FF6C37?style=for-the-badge&logo=postman)
![Grafana](https://img.shields.io/badge/Grafana-F46800?style=for-the-badge&logo=grafana)
![Prometheus](https://img.shields.io/badge/Prometheus-E6522C?style=for-the-badge&logo=prometheus)
![JMeter](https://img.shields.io/badge/JMeter-D22128?style=for-the-badge&logo=apache)

### Frontend
![JavaScript](https://img.shields.io/badge/JavaScript-F7DF1E?style=for-the-badge&logo=javascript)
![Thymeleaf](https://img.shields.io/badge/Thymeleaf-005F0F?style=for-the-badge&logo=thymeleaf)
![HTML5](https://img.shields.io/badge/HTML5-E34F26?style=for-the-badge&logo=html5)
![CSS3](https://img.shields.io/badge/CSS3-1572B6?style=for-the-badge&logo=css3)
![FullCalendar](https://img.shields.io/badge/FullCalendar-FF6B35?style=for-the-badge)

### External APIs
![Google OAuth](https://img.shields.io/badge/Google%20OAuth-4285F4?style=for-the-badge&logo=google)
![Google Gmail](https://img.shields.io/badge/Gmail%20API-EA4335?style=for-the-badge&logo=gmail)
![Kakao Map](https://img.shields.io/badge/Kakao%20Map-FFCD00?style=for-the-badge&logo=kakao)

### Development Tools
![IntelliJ IDEA](https://img.shields.io/badge/IntelliJ%20IDEA-000000?style=for-the-badge&logo=intellijidea)

### Collaboration
![Notion](https://img.shields.io/badge/Notion-000000?style=for-the-badge&logo=notion)
![GitHub](https://img.shields.io/badge/GitHub-181717?style=for-the-badge&logo=github)
![Slack](https://img.shields.io/badge/Slack-4A154B?style=for-the-badge&logo=slack)
![ERDCloud](https://img.shields.io/badge/ERD%20Cloud-4285F4?style=for-the-badge)
![Figma](https://img.shields.io/badge/Figma-F24E1E?style=for-the-badge&logo=figma)


## ✨ 핵심 기능

### 💬 반려인 커뮤니티
- **일상 공유**: 반려동물과의 소소한 일상을 자유롭게 공유
- **정보 교환**: 댓글을 통한 실용적인 정보 공유 및 소통
- **중고 거래**: 반려용품 중고거래 및 판매자와의 실시간 채팅 기능

### 🏠️ 반려동물 친화적 장소
- **장소 탐색**: 반려동물 동반 가능한 식당, 카페, 숙소 정보
- **리뷰 시스템**: 사용자 리뷰 및 별점으로 신뢰성 있는 정보 제공
- **인기 장소**: 좋아요 기반 인기 플레이스 추천

### ✉️ 데일리 기록
- **데일리 앨범**: 하루 한 컷, 반려동물과의 추억 저장
- **데일리 QnA**: 매일 다른 질문에 답변 작성, 1년 후 같은 질문에 대한 답을 보며 추억 회상

### ⚙️ 추가 기능
- **권한 분리**: 비회원/회원/관리자 구분된 접근 제어
- **실시간 알림**: 스케줄러 기반 데일리 질문 알림
- **유저 정보 관리 자동화**: 스케줄러 기반 휴면/정지/탈퇴 유저의 정보 관리 자동화




## 🏗️ 시스템 아키텍처
![아키텍쳐 vpc az수정](https://github.com/user-attachments/assets/3e01e12d-e90e-4bc2-944a-7b05721683da)



### 🔧 인프라 구성
| 서비스 | 사양 | 역할 |
|--------|------|------|
| **EC2** | t3.medium | 애플리케이션 서버 |
| **RDS** | t4g.micro (MySQL) | 관계형 데이터베이스 |
| **ElastiCache** | t2.micro (Redis OSS) | 캐싱 및 세션 관리 |
| **ECR** | Private Repository | 컨테이너 이미지 저장 |
| **S3** | Standard | 사용자 업로드 파일 관리 |
| **MongoDB Atlas** | - | 채팅 데이터 저장 |



### 🚀 CI/CD 파이프라인

```mermaid
graph LR
    A[GitHub] --> B[GitHub Actions]
    B --> C[Docker Build]
    C --> D[ECR Push]
    D --> E[EC2 Deploy]
```


## 💫 주요 기술적 의사결정

<details>
<summary>☀️ JWT + Redis 기반 보안 강화</summary>

**🔹 배경**  
- JWT의 무상태 특성으로 로그아웃 후에도 토큰이 유효기간 내라면 인증된 것처럼 동작하는 보안 취약점 발견  
- 토큰 탈취 시 즉각적인 대응이 어려운 구조적 문제점 인식  

**🔹 비교**  
- Session 방식: 서버 메모리 사용량 증가, 확장성 제약  
- JWT만 사용: 로그아웃 처리 불가, 토큰 무효화 어려움  
- JWT + Redis: 무상태성 유지하면서 실시간 토큰 제어 가능  

**🔹 결론**  
- Redis 블랙리스트와 TTL을 활용한 JWT 보안 강화 구현  
- 로그아웃 시 AccessToken 블랙리스트 등록으로 즉시 차단, 자동 만료로 서버 부하 최소화  
</details>

<details>
<summary>☀️ MongoDB Atlas 선택 (vs DocumentDB)</summary>

**🔹 배경**  
- 채팅 기능 구현을 위한 NoSQL 데이터베이스 필요  
- AWS DocumentDB와 MongoDB Atlas 중 선택 고민  

**🔹 비교**  
- DocumentDB: AWS 네이티브 통합 우수, 하지만 MongoDB 100% 호환성 미보장  
- MongoDB Atlas: 완전한 MongoDB 호환성, 무료 티어 제공  
- 호환성 리스크: DocumentDB는 버전 차이로 인한 쿼리 동작 차이 가능성  

**🔹 결론**  
- 기존 코드와의 100% 호환성과 개발 일정을 고려하여 MongoDB Atlas 선택  
- 안정성과 빠른 배포를 우선시한 현실적 판단  
</details>

<details>
<summary>☀️ MongoDB에 바이너리 파일 적재하기</summary>

**🔹 배경**  
- 사용자가 채팅을 보낼 때 사진 보내기 기능이 필요했습니다.  
- 현재 MongoDB를 사용해 채팅을 저장 중이며,  
  `@MessageMapping` 어노테이션과 `messagingTemplate`을 활용해 웹소켓 기반 채팅을 구현했습니다.  
- 이로 인해 다음과 같은 문제점이 발생했습니다:  
  - 바이너리 파일 저장 시 base64로 인코딩이 필요함  
  - 클라이언트가 저장 요청을 보낼 때, 이미지 형식이 맞는지 서버에서 검증해야 함  

**🔹 고려 사항**

| 항목 | 고려 사항 |
|------|------------|
| 파일 저장 방식 | S3로 업로드 → MongoDB에는 URL만 저장 |
| 업로드 성공 여부 | 클라이언트가 파일을 업로드한 후 서버에 알려야 함 |
| 파일 타입 | 잘못된 파일이 저장되지 않도록 업로드 시 검증 필요 |
| 저장 항목 | 파일명, MIME 타입, S3 URL, 유저 ID 등 |

**🔹 결론**  
- 클라이언트가 **Presigned URL**을 통해 S3에 직접 사진을 업로드하도록 구현  
- 서버는 업로드 URL만 응답하고, 클라이언트가 업로드 완료 후 해당 URL을 DB에 저장 요청  
- 이렇게 하여 **파일 유효성 검증 부담을 줄이고**, **서버 부하 및 비용도 절감**  
</details>


<details>
<summary>☀️ Grafana + Prometheus 모니터링</summary>

**🔹 배경**  
- AWS 기반 운영 환경에서 시스템 상태 실시간 모니터링 필요  
- 장애 상황 빠른 파악과 대응을 위한 가시화된 모니터링 체계 구축  

**🔹 비교**  
- 로그만 사용: 문제 파악에 시간 소요, 사후 대응적  
- CloudWatch: AWS 네이티브하지만 커스터마이징 제약  
- Grafana + Prometheus: 유연한 대시보드, 다양한 데이터 소스 연동 가능  

**🔹 결론**  
- Spring Boot Actuator와 Prometheus 연동으로 메트릭 수집  
- Grafana 대시보드로 CPU, 메모리, HTTP 응답시간 등 실시간 모니터링 구현  
</details>



## 📈 모니터링

**Grafana + Prometheus 모니터링 시스템**
- **시스템 메트릭**: CPU, 메모리, 네트워크 사용량 실시간 모니터링
- **애플리케이션 메트릭**: HTTP 응답 시간, DB 지연 시간 추적



## 📊 성능 개선

<details>
<summary>🚀 스프링 배치를 통한 91% 성능 개선</summary>

**🔹 기능 소개**  
- 매일 자정마다 유저에게 데일리 질문 알림을 발송하는 기능 구현  
- `Notification` 엔티티를 사용해 유저와 알림 내용을 저장  

**🔹 기술 결정 과정**  
- 기존 `findAll()` + 반복 저장 방식은 유저 수 증가 시 병목 발생  
- Spring Batch + `chunk` 기반 처리로 대체  
- `TaskExecutor`로 멀티스레드 병렬 처리 적용  

**🔹 성능 테스트 결과**  
- 기존 방식: 10만명 기준 평균 **58초**  
- Spring Batch + 비동기 처리: **7초**  
- JdbcCursorItemReader로 리팩토링 후: **5초**  
- **총 91.3% 성능 개선** 달성  

**🔹 회고**  
- 단순 반복 저장 방식의 병목 문제를 Spring Batch로 해결  
- reader/processor/writer 구조와 JDBC vs JPA 차이 학습  
- 향후 파티셔닝 도입 및 병렬 Step 처리 고려 예정  

</details>

<details>
<summary>🚀 Redis 캐싱을 통한 인기 랭킹 성능 개선</summary>

**🔹 기능 소개**  
- 인기 장소 랭킹 데이터를 Redis에 캐싱하여 빠르게 조회  

**🔹 기술 결정 과정**  
- 기존 방식: QueryDSL로 DB 직접 조회 (좋아요 수 기준 정렬)  
- 리팩토링 방식: Redis ZSet을 사용해 랭킹 구현  
  - 좋아요 시 score 증가, 취소 시 감소  
  - 캐시된 `placeId`로 DB에서 상세 데이터 조회  

**🔹 성능 테스트 결과 (JMeter + Grafana)**  
- 평균 응답시간: **509ms 개선 (약 3.1%)**  
- 최소 응답시간: **5ms (SQL 대비 15배 빠름)**  
- 3000명 동시 접속 시 **0% 오류율**  
- Redis가 응답 지연과 부하 분산에 효과적임 확인  

**🔹 회고**  
- Redis 도입으로 캐시 기반 구조의 이점 체감  
- 과부하 상황에서 서버 자원 한계를 시각화하며 대응 전략 필요성 인지  
- 추후 TTL 설정, 조회 필드 최적화, 인덱싱 등도 개선 포인트로 도출  

</details>



## 🚨 주요 트러블슈팅

<details>
<summary>⚠️ Docker 빌드 캐시 이슈</summary>

- **문제**: 코드 수정 후 배포했으나 변경사항이 반영되지 않음<br/>
- **원인**: Docker 레이어 캐시로 인해 소스코드 변경이 감지되지 않음<br/>
- **해결**: `--no-cache` 옵션 사용 및 빌드 단계 최적화

</details>

<details>
<summary>⚠️ JPA Lazy Loading으로 인한 401 에러</summary>

- **문제**: Security 설정에 문제없음에도 401 Unauthorized 발생<br/>
- **원인**: LazyInitializationException이 Security Filter에서 401로 변환됨<br/>
- **해결**: QueryDSL fetch join 적용 및 GlobalExceptionHandler 보강<br/>

</details>

<details>
<summary>⚠️ Rate Limiting 버킷 초기화 문제</summary>

- **문제**: Bucket4j Rate Limiting이 매 요청마다 초기화됨<br/>
- **원인**: BucketConfiguration이 매번 새로 생성됨<br/>
- **해결**: 필드 레벨에서 고정된 Configuration 사용

</details>

## 🛡️ Test Coverage
![화면 캡처 2025-07-06 163040](https://github.com/user-attachments/assets/e0adc662-2ae7-4cf6-85f0-d06a57e17c33)

## 📱 주요 화면

| 메인 페이지 | 커뮤니티 | 플레이스 |
|-------------|----------|----------|
| <img src="https://github.com/user-attachments/assets/68c9feaf-ff41-4d1f-b0c7-2dc66155e03d" width = "200"/> | <img src="https://github.com/user-attachments/assets/1092473b-765b-4540-a238-5d1bdd79b10a" width = "200"/>| <img src="https://github.com/user-attachments/assets/bef7597f-801c-426d-8a4d-2dcab8bc4cc2" width = "200"/> |

| 로그인 | 채팅 | 캘린더 |
|-------------|------|--------|
| <img src="https://github.com/user-attachments/assets/0a551055-ba1e-4b26-896c-18bf08f3a8e5" width = "200"/> | <img src="https://github.com/user-attachments/assets/ec721a74-3bb7-4082-9105-898796bee698" width = "200"/>| <img src="https://github.com/user-attachments/assets/491ae3a5-6cfb-4a7e-aa51-007a0cb4f9a6" width = "200"/> |

## 🗂️ 프로젝트 구조

```
📦 petory
├── 📂 src/main/java/com/study/petory
│   ├── 📂 common                  # 공통 유틸리티 및 설정
│   │   ├── 📂 config              # 설정 클래스들
│   │   ├── 📂 entity              # 공용 엔티티
│   │   ├── 📂 exception           # 예외 처리
│   │   ├── 📂 ratelimit           # 별점 처리
│   │   ├── 📂 response            # 공통 응답
│   │   ├── 📂 scheduler           # 스케쥴러
│   │   ├── 📂 security            # 보안 설정
│   │   ├── 📂 service             # 공용 서비스
│   │   └── 📂 util                # 유틸리티 클래스
│   ├── 📂 domain
│   │   ├── 📂 album               # 반려동물 사진 저장
│   │   ├── 📂 chat                # 채팅 기능
│   │   ├── 📂 dailyqna            # 데일리 질문
│   │   ├── 📂 event               # 일정 관리
│   │   ├── 📂 notification        # 알림 기능
│   │   ├── 📂 ownerBoard          # 커뮤니티 게시판
│   │   ├── 📂 pet                 # 반려동물 관리
│   │   ├── 📂 place               # 장소 관리
│   │   ├── 📂 tradeboard          # 중고거래 게시판
│   └── └── 📂 user                # 사용자 관리
├── 📂 src/main/resources
│   ├── 📂 static                  # 정적 리소스
│   ├── 📂 templates               # Thymeleaf 템플릿
│   └── 📄 application.properties  # 애플리케이션 설정
├── 📄 docker-compose.yml    
└── 📄 Dockerfile
```


## 📝 API 문서

자세한 API 문서는 [Postman Documentation](https://documenter.getpostman.com/view/43234443/2sB2xE9ndC)에서 확인하실 수 있습니다.

### 주요 API 엔드포인트

| 기능 | Method | Endpoint | 설명 |
|------|--------|----------|------|
| 로그인 | GET | `/oauth2/authorization/google` | Google OAuth2 로그인 |
| 반려동물 등록 | POST | `/pet` | 사용자의 반려동물 등록 |
| 앨범 조회 | GET | `/users/my/albums` | 사용자가 기록한 사진 전체 조회 |
| 데일리 질문 | GET | `/daily-questions/today` | 오늘의 질문 조회|
| 플레이스 검색 | GET | `/places` | 반려동물 동반 장소 조회 |
| 게시글 목록 | GET | `/owner-boards` | 커뮤니티 게시글 전체 조회|
| 채팅 시작 | GET | `/chat/{chatId}` | 채팅방 입장 |
| 알림 전체 조회 | GET | `/notifications` | 오늘의 질문 알림 조회|
| 일정 생성 | POST | `/users/events` | 일정 생성 |


## 👥 팀원 소개

| 역할 | 이름  | 담당 기능                                                        | GitHub                              |
|------|-----|--------------------------------------------------------------|-------------------------------------|
| **BE 개발자** | 양재호 | 팀장, Place 도메인, KaKaoMap API 연동, Rate Limiting 기능             | [🐹](https://github.com/jhyang22) |
| **BE 개발자** | 김하정 | 부팀장, 인증/보안, 비회원/회원 기준 인가, 회원세부 권한 기준 인가, 유저 정보 관리 자동화, User/Pet 도메인 | [😺](https://github.com/mueiso)    |
| **BE 개발자** | 김채원 | TradeBoard 도메인, 채팅 기능, 데일리 질문 알림 기능 구현 및 최적화                 | [🐰](https://github.com/chaewon9999)     |
| **BE 개발자** | 심재민 | DailyQnQ 도메인, Album 도메인                | [🦊](https://github.com/Deabaind)      |
| **BE 개발자** | 이은지 | OwnerBoard 도메인, AWS 인프라 구축, CI/CD                            | [🦦](https://github.com/222eunji)   |


## 📌 Git convention

**🔹 PR / 이슈 관리**
- [PR 예시: ]([gh pr checkout 126](https://github.com/jhyang22/Petory/pull/126))

- [이슈 예시: ]([[gh issues checkout 183](https://github.com/jhyang22/Petory/issues/183)

## 🏆 향후 개선 계획

### 🔦 기능 확장
- [ ] 캘린더에서 반려동물 D-day 알림 추가
- [ ] 반려 동물의 성장 일지 기록하기

### 🔐 보안 강화
- [ ] Parameter Store를 통한 환경변수 중앙 관리
- [ ] Private Subnet으로 EC2 이동 및 NAT Gateway 구성

### 📈 확장성 개선
- [ ] Auto Scaling Group 적용
- [ ] Application Load Balancer 도입

### 🚀 성능 최적화
- [ ] Spring Batch 파티셔닝 적용

---

<div align="center">


**🐾 PETORY와 함께 반려동물과의 소중한 순간을 기록하세요! 🐾**

Made with ❤️ by PETORY Team
</div>
