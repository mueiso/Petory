<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆì´ í˜ì´ì§€ - ìº˜ë¦°ë”</title>
    
    <!-- FullCalendar CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.8/index.min.css" rel="stylesheet">
    
    <!-- Bootstrap CSS -->
    <link href="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/css/bootstrap.min.css" rel="stylesheet">
    
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            background-color: #f8f9fa;
            color: #333;
        }
        
        /* í—¤ë” ìŠ¤íƒ€ì¼ */
        .header {
            background: white;
            border-bottom: 1px solid #e9ecef;
            padding: 15px 0;
            box-shadow: 0 2px 4px rgba(0,0,0,0.08);
        }
        
        .header-content {
            max-width: 1200px;
            margin: 0 auto;
            display: flex;
            justify-content: space-between;
            align-items: center;
            padding: 0 20px;
        }
        
        .logo {
            font-size: 18px;
            font-weight: 600;
            color: #ff6b35;
        }
        
        .nav-menu {
            display: flex;
            gap: 30px;
            list-style: none;
        }
        
        .nav-menu a {
            text-decoration: none;
            color: #666;
            font-size: 14px;
            font-weight: 500;
            transition: color 0.3s ease;
        }
        
        .nav-menu a:hover,
        .nav-menu a.active {
            color: #333;
        }
        
        .header-actions {
            display: flex;
            align-items: center;
            gap: 15px;
        }
        
        .search-box {
            position: relative;
        }
        
        .search-box input {
            padding: 8px 35px 8px 15px;
            border: 1px solid #ddd;
            border-radius: 20px;
            font-size: 14px;
            width: 200px;
        }
        
        .search-box::after {
            content: 'ğŸ”';
            position: absolute;
            right: 12px;
            top: 50%;
            transform: translateY(-50%);
        }
        
        .login-btn {
            background: none;
            border: none;
            color: #666;
            font-size: 14px;
            cursor: pointer;
        }
        
        /* ë©”ì¸ ì»¨í…Œì´ë„ˆ */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }
        
        .page-title {
            font-size: 32px;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
        }
        
        /* íƒ­ ë„¤ë¹„ê²Œì´ì…˜ */
        .tab-nav {
            display: flex;
            gap: 0;
            margin-bottom: 40px;
            border-bottom: 1px solid #e9ecef;
        }
        
        .tab-nav button {
            background: none;
            border: none;
            padding: 15px 20px;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .tab-nav button.active {
            color: #ff6b35;
            border-bottom-color: #ff6b35;
        }
        
        .tab-nav button:hover {
            color: #333;
        }
        
        /* ìº˜ë¦°ë” ì„¹ì…˜ */
        .calendar-section {
            background: white;
            border-radius: 12px;
            padding: 30px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            margin-bottom: 30px;
        }
        
        .calendar-header {
            margin-bottom: 25px;
            padding-bottom: 15px;
            border-bottom: 1px solid #f0f0f0;
        }
        
        .calendar-title {
            font-size: 24px;
            font-weight: 600;
            color: #333;
        }
        
        /* FullCalendar ì»¤ìŠ¤í…€ ìŠ¤íƒ€ì¼ */
        #calendar {
            font-family: inherit;
        }
        
        .fc-toolbar-title {
            font-size: 1.5rem !important;
            font-weight: 600 !important;
            color: #333 !important;
        }
        
        .fc-button-primary {
            background: #ff6b35 !important;
            border: none !important;
            border-radius: 6px !important;
            padding: 6px 12px !important;
            font-size: 14px !important;
            font-weight: 500 !important;
            transition: all 0.3s ease !important;
        }
        
        .fc-button-primary:hover {
            background: #e55a2b !important;
            transform: translateY(-1px) !important;
        }
        
        .fc-button-primary:disabled {
            background: #ccc !important;
            transform: none !important;
        }
        
        .fc-event {
            border-radius: 4px !important;
            border: none !important;
            font-size: 13px !important;
            font-weight: 500 !important;
            padding: 2px 6px !important;
            transition: all 0.2s ease !important;
        }
        
        .fc-event:hover {
            transform: scale(1.02) !important;
            box-shadow: 0 2px 8px rgba(0, 0, 0, 0.15) !important;
        }
        
        .fc-daygrid-day-number {
            color: #333 !important;
            font-weight: 500 !important;
        }
        
        .fc-col-header-cell {
            background: #f8f9fa !important;
            border-color: #e9ecef !important;
        }
        
        .fc-daygrid-day {
            border-color: #e9ecef !important;
        }
        
        .fc-today {
            background: rgba(255, 107, 53, 0.1) !important;
        }
        
        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal-content {
            border: none;
            border-radius: 12px;
            box-shadow: 0 10px 40px rgba(0, 0, 0, 0.15);
        }
        
        .modal-header {
            background: #ff6b35;
            color: white;
            border-radius: 12px 12px 0 0;
            border: none;
            padding: 20px 25px;
        }
        
        .modal-title {
            font-size: 18px;
            font-weight: 600;
        }
        
        .modal-body {
            padding: 25px;
        }
        
        .form-label {
            font-weight: 500;
            color: #333;
            margin-bottom: 8px;
        }
        
        .form-control {
            border: 2px solid #e9ecef;
            border-radius: 8px;
            padding: 12px 15px;
            font-size: 14px;
            transition: all 0.3s ease;
        }
        
        .form-control:focus {
            border-color: #ff6b35;
            box-shadow: 0 0 0 3px rgba(255, 107, 53, 0.1);
        }
        
        .color-picker {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
            margin-top: 10px;
        }
        
        .color-option {
            width: 28px;
            height: 28px;
            border-radius: 50%;
            cursor: pointer;
            border: 3px solid transparent;
            transition: all 0.3s ease;
        }
        
        .color-option:hover {
            transform: scale(1.15);
        }
        
        .color-option.selected {
            border-color: #333;
            transform: scale(1.15);
        }
        
        .btn-primary {
            background: #ff6b35;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
            transition: all 0.3s ease;
        }
        
        .btn-primary:hover {
            background: #e55a2b;
            transform: translateY(-1px);
        }
        
        .btn-secondary {
            background: #6c757d;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
        }
        
        .btn-danger {
            background: #dc3545;
            border: none;
            border-radius: 8px;
            padding: 10px 20px;
            font-weight: 500;
        }
        
        /* ì•Œë¦¼ ìŠ¤íƒ€ì¼ */
        .alert {
            border: none;
            border-radius: 8px;
            margin-bottom: 20px;
            font-weight: 500;
        }
        
        .alert-success {
            background: #d4edda;
            color: #155724;
            border-left: 4px solid #28a745;
        }
        
        .alert-danger {
            background: #f8d7da;
            color: #721c24;
            border-left: 4px solid #dc3545;
        }
        
        /* í‘¸í„° */
        .footer {
            background: white;
            border-top: 1px solid #e9ecef;
            padding: 40px 0;
            margin-top: 60px;
            text-align: center;
        }
        
        .footer-content {
            max-width: 1200px;
            margin: 0 auto;
            padding: 0 20px;
        }
        
        .footer-links {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 20px;
        }
        
        .footer-links a {
            text-decoration: none;
            color: #666;
            font-size: 14px;
        }
        
        .social-links {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }
        
        .social-links a {
            width: 36px;
            height: 36px;
            background: #f8f9fa;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: #666;
            transition: all 0.3s ease;
        }
        
        .social-links a:hover {
            background: #ff6b35;
            color: white;
        }
        
        .copyright {
            color: #999;
            font-size: 13px;
        }

        /* í† í° ì„¤ì • ì˜ì—­ */
        .token-section {
            background: #fff3cd;
            border: 1px solid #ffeaa7;
            border-radius: 8px;
            padding: 15px;
            margin-bottom: 20px;
            font-size: 14px;
        }
        
        .token-section strong {
            color: #856404;
        }
    </style>
</head>
<body>
    <!-- í—¤ë” -->
    <header class="header">
        <div class="header-content">
            <div class="logo">petory</div>
            <nav>
                <ul class="nav-menu">
                    <li><a href="#" class="active">Daily Photo Record</a></li>
                    <li><a href="#">Community</a></li>
                    <li><a href="#">Pet Places</a></li>
                    <li><a href="#">Contact Us</a></li>
                </ul>
            </nav>
            <div class="header-actions">
                <div class="search-box">
                    <input type="text" placeholder="Search">
                </div>
                <button class="login-btn">ğŸ‘¤ login</button>
            </div>
        </div>
    </header>

    <!-- ë©”ì¸ ì»¨í…Œì´ë„ˆ -->
    <div class="main-container">
        <h1 class="page-title">ë§ˆì´ í˜ì´ì§€</h1>
        
        <!-- íƒ­ ë„¤ë¹„ê²Œì´ì…˜ -->
        <div class="tab-nav">
            <button>ì‚¬ì§„ ê¸°ë¡</button>
            <button>ì¢‹ì€ ê¸°ë¡</button>
            <button class="active">ìº˜ë¦°ë”</button>
            <button>ê¸‰ì—¬ ê³„ì‚°</button>
        </div>

        <!-- í† í° ì„¤ì • ì•ˆë‚´ -->
        <div class="token-section">
            <strong>ê°œë°œì ì•ˆë‚´:</strong> JavaScript ì½”ë“œì—ì„œ ACCESS_TOKEN ë³€ìˆ˜ì— ì¸ì¦ í† í°ì„ ì„¤ì •í•´ì£¼ì„¸ìš”.
        </div>
        
        <!-- ì•Œë¦¼ ì»¨í…Œì´ë„ˆ -->
        <div id="alertContainer"></div>
        
        <!-- ìº˜ë¦°ë” ì„¹ì…˜ -->
        <div class="calendar-section">
            <div class="calendar-header">
                <h2 class="calendar-title">ìº˜ë¦°ë”</h2>
            </div>
            <div id="calendar"></div>
        </div>
    </div>

    <!-- ì¼ì • ì¶”ê°€/ìˆ˜ì • ëª¨ë‹¬ -->
    <div class="modal fade" id="eventModal" tabindex="-1">
        <div class="modal-dialog">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title" id="modalTitle">ì¼ì • ì¶”ê°€</h5>
                    <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <form id="eventForm">
                        <div class="mb-3">
                            <label class="form-label">ì œëª© *</label>
                            <input type="text" class="form-control" id="eventTitle" required>
                        </div>
                        
                        <div class="row mb-3">
                            <div class="col-md-6">
                                <label class="form-label">ì‹œì‘ì¼ *</label>
                                <input type="datetime-local" class="form-control" id="eventStart" required>
                            </div>
                            <div class="col-md-6">
                                <label class="form-label">ì¢…ë£Œì¼</label>
                                <input type="datetime-local" class="form-control" id="eventEnd">
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <div class="form-check">
                                <input class="form-check-input" type="checkbox" id="eventAllDay">
                                <label class="form-check-label" for="eventAllDay">
                                    í•˜ë£¨ ì¢…ì¼
                                </label>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">ì„¤ëª…</label>
                            <textarea class="form-control" id="eventDescription" rows="3"></textarea>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">ìƒ‰ìƒ</label>
                            <div class="color-picker">
                                <div class="color-option" data-color="1" style="background-color: #a4bdfc;"></div>
                                <div class="color-option" data-color="2" style="background-color: #7ae7bf;"></div>
                                <div class="color-option" data-color="3" style="background-color: #dbadff;"></div>
                                <div class="color-option" data-color="4" style="background-color: #ff887c;"></div>
                                <div class="color-option" data-color="5" style="background-color: #fbd75b;"></div>
                                <div class="color-option" data-color="6" style="background-color: #ffb878;"></div>
                                <div class="color-option" data-color="7" style="background-color: #46d6db;"></div>
                                <div class="color-option" data-color="8" style="background-color: #e1e1e1;"></div>
                                <div class="color-option" data-color="9" style="background-color: #5484ed;"></div>
                                <div class="color-option" data-color="10" style="background-color: #51b749;"></div>
                                <div class="color-option" data-color="11" style="background-color: #dc2127;"></div>
                            </div>
                        </div>
                        
                        <div class="mb-3">
                            <label class="form-label">ë°˜ë³µ ì„¤ì •</label>
                            <select class="form-control" id="eventRecurrence">
                                <option value="">ë°˜ë³µ ì—†ìŒ</option>
                                <option value="FREQ=DAILY">ë§¤ì¼</option>
                                <option value="FREQ=WEEKLY">ë§¤ì£¼</option>
                                <option value="FREQ=MONTHLY">ë§¤ì›”</option>
                                <option value="FREQ=YEARLY">ë§¤ë…„</option>
                            </select>
                        </div>
                    </form>
                </div>
                <div class="modal-footer">
                    <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">ì·¨ì†Œ</button>
                    <button type="button" class="btn btn-danger" id="deleteEventBtn" style="display: none;">ì‚­ì œ</button>
                    <button type="button" class="btn btn-primary" id="saveEventBtn">ì €ì¥</button>
                </div>
            </div>
        </div>
    </div>

    <!-- í‘¸í„° -->
    <footer class="footer">
        <div class="footer-content">
            <div class="footer-links">
                <a href="#">About Us</a>
                <a href="#">Contact</a>
                <a href="#">Terms of Service</a>
            </div>
            <div class="social-links">
                <a href="#">ğŸ’Œ</a>
                <a href="#">ğŸ“·</a>
                <a href="#">ğŸ”—</a>
            </div>
            <div class="copyright">
                Â©2024 Petory. All rights reserved.
            </div>
        </div>
    </footer>

    <!-- FullCalendar JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/6.1.8/index.global.min.js"></script>
    <!-- Bootstrap JS -->
    <script src="https://cdnjs.cloudflare.com/ajax/libs/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>

    <script>
        let calendar;
        let currentEventId = null;
        let selectedColor = '1';
        const API_BASE_URL = 'http://localhost:8080/calendars';
        const DEFAULT_TIMEZONE = 'Asia/Seoul';
        
        // ğŸ”‘ ì—¬ê¸°ì— Access Tokenì„ ì…ë ¥í•˜ì„¸ìš”
        const ACCESS_TOKEN = 'Bearer eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxIiwiZW1haWwiOiJhQGVtYWlsLmNvbSIsIm5pY2tuYW1lIjoi7Jyg7KCAIiwicm9sZXMiOltdLCJleHAiOjE3NTEyNzYyNzAsImlhdCI6MTc1MTI3MjY3MH0.316cjcRO4pgg1BQYLz0t1jiVvGNu1mMHo9lhWJPNoEk';
        
        // EventColor enum ë§¤í•‘
        const EVENT_COLORS = {
            'LAVENDER': '#a4bdfc',   // LAVENDER
            'SAGE': '#7ae7bf',   // SAGE
            'GRAPE': '#dbadff',   // GRAPE
            'FLAMINGO': '#ff887c',   // FLAMINGO
            'BANANA': '#fbd75b',   // BANANA
            'TANGERINE': '#ffb878',   // TANGERINE
            'PEACOCK': '#46d6db',   // PEACOCK
            'GRAPHITE': '#e1e1e1',   // GRAPHITE
            'BLUEBERRY': '#5484ed',   // BLUEBERRY
            'BASIL': '#51b749',  // BASIL
            'TOMATO': '#dc2127'   // TOMATO
        };

        // ì•Œë¦¼ í‘œì‹œ í•¨ìˆ˜
        function showAlert(message, type = 'success') {
            const alertContainer = document.getElementById('alertContainer');
            const alert = document.createElement('div');
            alert.className = `alert alert-${type} alert-dismissible fade show`;
            alert.innerHTML = `
                ${message}
                <button type="button" class="btn-close" data-bs-dismiss="alert"></button>
            `;
            alertContainer.appendChild(alert);
            
            setTimeout(() => {
                alert.remove();
            }, 5000);
        }

        // API ìš”ì²­ í—¤ë” ìƒì„±
        function getAuthHeaders() {
            if (!ACCESS_TOKEN || ACCESS_TOKEN === 'your-access-token-here') {
                throw new Error('ACCESS_TOKENì„ ì„¤ì •í•´ì£¼ì„¸ìš”.');
            }
            return {
                'Content-Type': 'application/json',
                'Authorization': ACCESS_TOKEN
            };
        }

        // ë‚ ì§œ í¬ë§· ë³€í™˜ í•¨ìˆ˜
        function formatDateForAPI(date) {
            if (!date) return null;
            return new Date(date).toISOString().slice(0, 19);
        }

        // ëª¨ë‹¬ í¼ ì´ˆê¸°í™”
        function resetModal() {
            document.getElementById('eventForm').reset();
            document.getElementById('eventRecurrence').value = '';
            document.getElementById('eventStart').type = 'datetime-local';
            document.getElementById('eventEnd').type = 'datetime-local';
            document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
            document.querySelector('.color-option').classList.add('selected');
            selectedColor = '1';
        }

        // ì¼ì • ëª¨ë‹¬ ì—´ê¸°
        function openEventModal(event = null, start = null, end = null) {
            if (event) {
                // ìˆ˜ì • ëª¨ë“œ - ê¸°ì¡´ ì¼ì • ì •ë³´ë¥¼ ì„œë²„ì—ì„œ ê°€ì ¸ì˜¤ê¸°
                currentEventId = event.id;
                loadEventDetails(event.id);
            } else {
                // ì¶”ê°€ ëª¨ë“œ
                currentEventId = null;
                resetModal();
                
                document.getElementById('modalTitle').textContent = 'ì¼ì • ì¶”ê°€';
                document.getElementById('eventAllDay').checked = false;
                document.getElementById('eventStart').value = start ? new Date(start).toISOString().slice(0, 16) : '';
                document.getElementById('eventEnd').value = end ? new Date(end).toISOString().slice(0, 16) : '';
                document.getElementById('deleteEventBtn').style.display = 'none';
                
                const modal = new bootstrap.Modal(document.getElementById('eventModal'));
                modal.show();
            }
        }

        // ì¼ì • ìƒì„¸ ì •ë³´ ë¡œë“œ (ìˆ˜ì • ëª¨ë“œìš©)
        async function loadEventDetails(eventId) {
            try {
                const headers = getAuthHeaders();
                const response = await fetch(`${API_BASE_URL}/${eventId}`, {
                    headers: headers
                });
                
                if (!response.ok) {
                    throw new Error('ì¼ì • ì •ë³´ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                
                const result = await response.json();
                const eventData = result.data;
                
                console.log('Loaded event data:', eventData);
                
                // í¼ ì´ˆê¸°í™”
                resetModal();
                
                // ìˆ˜ì • ëª¨ë“œ UI ì„¤ì •
                document.getElementById('modalTitle').textContent = 'ì¼ì • ìˆ˜ì •';
                document.getElementById('eventTitle').value = eventData.title || '';
                document.getElementById('eventAllDay').checked = eventData.isAllDay || false;
                document.getElementById('eventDescription').value = eventData.description || '';
                
                // í•˜ë£¨ì¢…ì¼ ì—¬ë¶€ì— ë”°ë¼ ì…ë ¥ í•„ë“œ íƒ€ì… ì„¤ì •
                if (eventData.isAllDay) {
                    document.getElementById('eventStart').type = 'date';
                    document.getElementById('eventEnd').type = 'date';
                    document.getElementById('eventStart').value = eventData.startDate ? eventData.startDate.split('T')[0] : '';
                    document.getElementById('eventEnd').value = eventData.endDate ? eventData.endDate.split('T')[0] : '';
                } else {
                    document.getElementById('eventStart').type = 'datetime-local';
                    document.getElementById('eventEnd').type = 'datetime-local';
                    document.getElementById('eventStart').value = eventData.startDate ? eventData.startDate.slice(0, 16) : '';
                    document.getElementById('eventEnd').value = eventData.endDate ? eventData.endDate.slice(0, 16) : '';
                }
                
                // ë°˜ë³µ ì„¤ì • ë¡œë“œ
                if (eventData.recurrence && eventData.recurrence.length > 0) {
                    const rrule = eventData.recurrence.find(r => r.startsWith('RRULE:'));
                    if (rrule) {
                        const ruleValue = rrule.replace('RRULE:', '');
                        document.getElementById('eventRecurrence').value = ruleValue;
                    }
                }
                
                document.getElementById('deleteEventBtn').style.display = 'inline-block';
                
                // ìƒ‰ìƒ ì„¤ì •
                selectedColor = eventData.color || '1';
                
                // ìƒ‰ìƒ ì„ íƒ í‘œì‹œ
                document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
                const colorOption = document.querySelector(`[data-color="${selectedColor}"]`);
                if (colorOption) {
                    colorOption.classList.add('selected');
                }
                
                // ëª¨ë‹¬ í‘œì‹œ
                const modal = new bootstrap.Modal(document.getElementById('eventModal'));
                modal.show();
                
            } catch (error) {
                console.error('Error loading event details:', error);
                showAlert(error.message, 'danger');
            }
        }

        // FullCalendar ì´ˆê¸°í™”
        document.addEventListener('DOMContentLoaded', function() {
            const calendarEl = document.getElementById('calendar');
            
            calendar = new FullCalendar.Calendar(calendarEl, {
                initialView: 'dayGridMonth',
                locale: 'ko',
                headerToolbar: {
                    left: 'prev,next today',
                    center: 'title',
                    right: 'dayGridMonth,timeGridWeek,timeGridDay'
                },
                buttonText: {
                    today: 'ì˜¤ëŠ˜',
                    month: 'ì›”',
                    week: 'ì£¼',
                    day: 'ì¼'
                },
                height: 'auto',
                editable: true,
                selectable: true,
                selectMirror: true,
                dayMaxEvents: true,
                eventDisplay: 'block',
                
                // ë‚ ì§œ ì„ íƒ ì‹œ ì¼ì • ì¶”ê°€
                select: function(info) {
                    openEventModal(null, info.start, info.end);
                },
                
                // ì¼ì • í´ë¦­ ì‹œ ìˆ˜ì •
                eventClick: function(info) {
                    openEventModal(info.event);
                },
                
                // ì¼ì • ë“œë˜ê·¸ ì•¤ ë“œë¡­
                eventDrop: function(info) {
                    updateEventDates(info.event);
                },
                
                // ì¼ì • ë¦¬ì‚¬ì´ì¦ˆ
                eventResize: function(info) {
                    updateEventDates(info.event);
                },
                
                // ë‚ ì§œ ë²”ìœ„ ë³€ê²½ ì‹œ ì¼ì • ë¡œë“œ
                datesSet: function(info) {
                    loadEvents(info.start, info.end);
                }
            });
            
            calendar.render();
            
            // ìƒ‰ìƒ ì„ íƒ ì´ë²¤íŠ¸
            document.querySelectorAll('.color-option').forEach(option => {
                option.addEventListener('click', function() {
                    document.querySelectorAll('.color-option').forEach(opt => opt.classList.remove('selected'));
                    this.classList.add('selected');
                    selectedColor = this.dataset.color;
                });
            });
            
            // í•˜ë£¨ì¢…ì¼ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
            document.getElementById('eventAllDay').addEventListener('change', function() {
                const isAllDay = this.checked;
                const startInput = document.getElementById('eventStart');
                const endInput = document.getElementById('eventEnd');
                
                if (isAllDay) {
                    startInput.type = 'date';
                    endInput.type = 'date';
                    
                    if (startInput.value) {
                        startInput.value = startInput.value.split('T')[0];
                    }
                    if (endInput.value) {
                        endInput.value = endInput.value.split('T')[0];
                    }
                } else {
                    startInput.type = 'datetime-local';
                    endInput.type = 'datetime-local';
                    
                    if (startInput.value && !startInput.value.includes('T')) {
                        startInput.value = startInput.value + 'T09:00';
                    }
                    if (endInput.value && !endInput.value.includes('T')) {
                        endInput.value = endInput.value + 'T18:00';
                    }
                }
            });
        });

        // ì¼ì • ë¡œë“œ
        async function loadEvents(start, end) {
            try {
                const headers = getAuthHeaders();
                const startStr = start.toISOString().slice(0, 19);
                const endStr = end.toISOString().slice(0, 19);
                
                const response = await fetch(`${API_BASE_URL}?start=${startStr}&end=${endStr}`, {
                    headers: headers
                });
                
                if (!response.ok) {
                    throw new Error('ì¼ì •ì„ ë¶ˆëŸ¬ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                
                const result = await response.json();
                const events = result.data.map(event => ({
                    id: event.id,
                    title: event.title,
                    start: event.startDate,
                    end: event.endDate,
                    allDay: event.isAllDay,
                    backgroundColor: EVENT_COLORS[event.color] || EVENT_COLORS['1'],
                    borderColor: EVENT_COLORS[event.color] || EVENT_COLORS['1']
                }));
                
                calendar.removeAllEvents();
                calendar.addEventSource(events);
                
            } catch (error) {
                if (error.message !== 'ACCESS_TOKENì„ ì„¤ì •í•´ì£¼ì„¸ìš”.') {
                    showAlert(error.message, 'danger');
                }
            }
        }

        // ì¼ì • ì €ì¥
        document.getElementById('saveEventBtn').addEventListener('click', async function() {
            try {
                const headers = getAuthHeaders();
                const isAllDay = document.getElementById('eventAllDay').checked;
                
                const formData = {
                    title: document.getElementById('eventTitle').value,
                    startDate: formatDateForAPI(document.getElementById('eventStart').value),
                    endDate: formatDateForAPI(document.getElementById('eventEnd').value),
                    timeZone: DEFAULT_TIMEZONE,
                    isAllDay: isAllDay,
                    description: document.getElementById('eventDescription').value,
                    color: selectedColor,
                    recurrence: document.getElementById('eventRecurrence').value ? 
                        [`RRULE:${document.getElementById('eventRecurrence').value}`] : null
                };
                
                let response;
                if (currentEventId) {
                    response = await fetch(`${API_BASE_URL}/${currentEventId}`, {
                        method: 'PUT',
                        headers: headers,
                        body: JSON.stringify(formData)
                    });
                } else {
                    response = await fetch(API_BASE_URL, {
                        method: 'POST',
                        headers: headers,
                        body: JSON.stringify(formData)
                    });
                }
                
                if (!response.ok) {
                    throw new Error('ì¼ì • ì €ì¥ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                
                showAlert(currentEventId ? 'ì¼ì •ì´ ìˆ˜ì •ë˜ì—ˆìŠµë‹ˆë‹¤.' : 'ì¼ì •ì´ ì¶”ê°€ë˜ì—ˆìŠµë‹ˆë‹¤.');
                bootstrap.Modal.getInstance(document.getElementById('eventModal')).hide();
                calendar.refetchEvents();
                
            } catch (error) {
                showAlert(error.message, 'danger');
            }
        });

        // ì¼ì • ì‚­ì œ
        document.getElementById('deleteEventBtn').addEventListener('click', async function() {
            if (!confirm('ì •ë§ë¡œ ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) return;
            
            try {
                const headers = getAuthHeaders();
                const response = await fetch(`${API_BASE_URL}/${currentEventId}`, {
                    method: 'DELETE',
                    headers: headers
                });
                
                if (!response.ok) {
                    throw new Error('ì¼ì • ì‚­ì œì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                
                showAlert('ì¼ì •ì´ ì‚­ì œë˜ì—ˆìŠµë‹ˆë‹¤.');
                bootstrap.Modal.getInstance(document.getElementById('eventModal')).hide();
                calendar.refetchEvents();
                
            } catch (error) {
                showAlert(error.message, 'danger');
            }
        });

        // ì¼ì • ë“œë˜ê·¸ ì•¤ ë“œë¡­ í›„ ì—…ë°ì´íŠ¸
        async function updateEventDates(event) {
            try {
                const headers = getAuthHeaders();
                
                const getResponse = await fetch(`${API_BASE_URL}/${event.id}`, {
                    headers: headers
                });
                
                if (!getResponse.ok) {
                    throw new Error('ì¼ì • ì •ë³´ë¥¼ ê°€ì ¸ì˜¤ëŠ”ë° ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                
                const eventData = await getResponse.json();
                const originalEvent = eventData.data;
                
                const updateData = {
                    title: originalEvent.title,
                    startDate: formatDateForAPI(event.start),
                    endDate: formatDateForAPI(event.end),
                    timeZone: DEFAULT_TIMEZONE,
                    isAllDay: event.allDay,
                    description: originalEvent.description,
                    color: originalEvent.color,
                    recurrence: originalEvent.recurrence
                };
                
                const response = await fetch(`${API_BASE_URL}/${event.id}`, {
                    method: 'PUT',
                    headers: headers,
                    body: JSON.stringify(updateData)
                });
                
                if (!response.ok) {
                    throw new Error('ì¼ì • ì—…ë°ì´íŠ¸ì— ì‹¤íŒ¨í–ˆìŠµë‹ˆë‹¤.');
                }
                
                showAlert('ì¼ì •ì´ ì—…ë°ì´íŠ¸ë˜ì—ˆìŠµë‹ˆë‹¤.');
                
            } catch (error) {
                showAlert(error.message, 'danger');
                calendar.refetchEvents();
            }
        }
    </script>
</body>
</html>