<!DOCTYPE html>
<html lang="ko">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ë§ˆì´ í˜ì´ì§€ - Petory</title>

    <!-- FullCalendar CSS -->
    <link href='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.11.5/main.min.css' rel='stylesheet'/>

    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background-color: #faf8f5;
            color: #333;
        }

        /* Header */
        header {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            padding: 1rem 2rem;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.1);
            position: sticky;
            top: 0;
            z-index: 100;
        }

        nav {
            display: flex;
            justify-content: space-between;
            align-items: center;
            max-width: 1200px;
            margin: 0 auto;
        }

        .logo {
            display: flex;
            align-items: center;
            gap: 0.5rem;
            font-size: 2rem;
            font-weight: bold;
            color: #5d4037;
            text-decoration: none;
        }

        .logo::before {
            content: "ğŸ¾";
            font-size: 1.5rem;
        }

        .nav-links {
            display: flex;
            gap: 2rem;
            list-style: none;
        }

        .nav-links a {
            text-decoration: none;
            color: #5d4037;
            font-weight: 500;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            transition: all 0.3s ease;
        }

        .nav-links a:hover {
            background: #ffcc80;
            transform: translateY(-2px);
        }

        .auth-buttons {
            display: flex;
            gap: 1rem;
            align-items: center;
        }

        .btn {
            padding: 0.5rem 1.5rem;
            border: none;
            border-radius: 25px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.3s ease;
            text-decoration: none;
            display: inline-block;
            text-align: center;
        }

        .btn-outline {
            background: transparent;
            color: #5d4037;
            border: 2px solid #5d4037;
        }

        .btn-outline:hover {
            background: #5d4037;
            color: white;
            transform: translateY(-2px);
        }

        .btn-primary {
            background: linear-gradient(45deg, #ff8a65, #ffab40);
            color: white;
            border: none;
        }

        .btn-primary:hover {
            transform: translateY(-2px);
            box-shadow: 0 5px 15px rgba(255, 138, 101, 0.4);
        }

        /* ë¡œê·¸ì¸ëœ ì‚¬ìš©ì ì •ë³´ ìŠ¤íƒ€ì¼ */
        .user-info {
            display: flex;
            align-items: center;
            gap: 1rem;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            border-radius: 50%;
            background: linear-gradient(45deg, #ffcc80, #ffab40);
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.2rem;
            color: white;
            font-weight: bold;
        }

        .user-name {
            color: #5d4037;
            font-weight: 600;
        }

        .logout-btn {
            background: #f44336;
            color: white;
            border: none;
            padding: 0.5rem 1rem;
            border-radius: 20px;
            cursor: pointer;
            transition: all 0.3s ease;
            font-size: 0.9rem;
        }

        .logout-btn:hover {
            background: #d32f2f;
            transform: translateY(-2px);
        }

        /* ìˆ¨ê¹€ ì²˜ë¦¬ */
        .hidden {
            display: none !important;
        }

        /* ë¡œë”© ìƒíƒœ */
        .auth-loading {
            color: #8d6e63;
            font-size: 0.9rem;
        }

        /* Main Content */
        .main-container {
            max-width: 1200px;
            margin: 0 auto;
            padding: 40px 20px;
        }

        .page-title {
            font-size: 32px;
            font-weight: 700;
            color: #333;
            margin-bottom: 30px;
        }

        /* Tab Navigation */
        .tab-nav {
            display: flex;
            gap: 0;
            margin-bottom: 40px;
            border-bottom: 2px solid #e8e5e0;
        }

        .tab-item {
            padding: 15px 25px;
            background: none;
            border: none;
            font-size: 16px;
            font-weight: 500;
            color: #666;
            cursor: pointer;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab-item.active {
            color: #d4a574;
            border-bottom-color: #d4a574;
        }

        .tab-item:hover {
            color: #d4a574;
        }

        /* Calendar Container */
        .calendar-container {
            background: white;
            border-radius: 15px;
            padding: 30px;
            box-shadow: 0 2px 20px rgba(0, 0, 0, 0.05);
            margin-top: 20px;
        }

        /* FullCalendar Custom Styles */
        .fc {
            font-family: inherit;
        }

        .fc-header-toolbar {
            margin-bottom: 20px !important;
        }

        .fc-toolbar-title {
            font-size: 28px !important;
            font-weight: 600 !important;
            color: #333 !important;
        }

        .fc-button-primary {
            background-color: #d4a574 !important;
            border-color: #d4a574 !important;
            color: white !important;
            border-radius: 8px !important;
            font-weight: 500 !important;
            padding: 8px 16px !important;
            margin-right: 4px !important;
        }

        /* ë„¤ë¹„ê²Œì´ì…˜ ë²„íŠ¼ (ì´ì „/ë‹¤ìŒ ì›”/ë…„) ì›í˜•ìœ¼ë¡œ */
        .fc-prev-button, .fc-next-button, .fc-prevYear-button, .fc-nextYear-button {
            padding: 0 !important;
            font-size: 16px !important;
            width: 35px !important;
            height: 35px !important;
            border-radius: 50% !important;
            background-color: transparent !important;
            border: 1px solid #d4a574 !important;
            color: #b8956a !important;
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            line-height: 1 !important;
        }

        .fc-prev-button:hover, .fc-next-button:hover, .fc-prevYear-button:hover, .fc-nextYear-button:hover {
            background-color: #d4a574 !important;
            border-color: #d4a574 !important;
            color: white !important;
        }

        /* í™”ì‚´í‘œ ì•„ì´ì½˜ ì¤‘ì•™ ì •ë ¬ */
        .fc-prev-button .fc-icon, .fc-next-button .fc-icon,
        .fc-prevYear-button .fc-icon, .fc-nextYear-button .fc-icon {
            display: flex !important;
            align-items: center !important;
            justify-content: center !important;
            width: 100% !important;
            height: 100% !important;
        }

        /* ì´ì „ ë²„íŠ¼ í™”ì‚´í‘œ ì¢Œì¸¡ìœ¼ë¡œ ì´ë™ */
        .fc-prev-button .fc-icon, .fc-prevYear-button .fc-icon {
            margin-left: -2px !important;
        }

        /* ë‹¤ìŒ ë²„íŠ¼ í™”ì‚´í‘œ ìš°ì¸¡ìœ¼ë¡œ ì´ë™ */
        .fc-next-button .fc-icon, .fc-nextYear-button .fc-icon {
            margin-right: -2px !important;
        }

        .fc-button-primary:hover {
            background-color: #c19660 !important;
            border-color: #c19660 !important;
        }

        .fc-button-primary:disabled {
            background-color: #e8e5e0 !important;
            border-color: #e8e5e0 !important;
            color: #999 !important;
        }

        .fc-daygrid-day {
            border-color: #f0f0f0 !important;
        }

        .fc-daygrid-day-number {
            color: #333 !important;
            font-weight: 500 !important;
            font-size: 16px !important;
            padding: 8px !important;
        }

        .fc-col-header-cell {
            background-color: #faf8f5 !important;
            border-color: #e8e5e0 !important;
        }

        .fc-col-header-cell-cushion {
            color: #666 !important;
            font-weight: 600 !important;
            font-size: 16px !important;
            padding: 12px 0 !important;
        }

        /* ì¼ìš”ì¼ (ì²« ë²ˆì§¸ ì—´) */
        .fc-col-header-cell:first-child .fc-col-header-cell-cushion {
            color: #e74c3c !important;
        }

        /* í† ìš”ì¼ (ë§ˆì§€ë§‰ ì—´) */
        .fc-col-header-cell:last-child .fc-col-header-cell-cushion {
            color: #3498db !important;
        }

        .fc-daygrid-day.fc-day-today {
            background-color: rgba(212, 165, 116, 0.3) !important;
        }

        .fc-daygrid-day.fc-day-today .fc-daygrid-day-number {
            color: #333 !important;
            font-weight: 600 !important;
        }

        .fc-daygrid-day-number {
            text-decoration: none !important;
        }

        .fc-daygrid-day-frame {
            min-height: 80px !important;
        }

        /* ì¼ì • ìŠ¤íƒ€ì¼ ì»¤ìŠ¤í„°ë§ˆì´ì§• */
        .fc-event {
            border: none !important;
            padding: 2px 6px !important;
            border-radius: 4px !important;
            font-size: 12px !important;
            font-weight: 500 !important;
            margin: 1px 0 !important;
        }

        /* ì¼ì • ì œëª©ë§Œ í‘œì‹œí•˜ê³  ì‹œê°„ ìˆ¨ê¹€ */
        .fc-event-time {
            display: none !important;
        }

        .fc-event-title {
            font-weight: 500 !important;
            color: white !important;
            text-shadow: 0 1px 1px rgba(0, 0, 0, 0.3) !important;
        }

        /* ì „ì²´ ë°°ê²½ìƒ‰ ì ìš©ì„ ìœ„í•œ ê°•ë ¥í•œ ìŠ¤íƒ€ì¼ */
        .fc-daygrid-event {
            background-color: inherit !important;
            border-color: inherit !important;
            border: none !important;
        }

        .fc-daygrid-event .fc-event-main {
            color: white !important;
            padding: 4px 6px !important;
        }

        /* ê° ìƒ‰ìƒë³„ ë°°ê²½ ê°•ì œ ì ìš© */
        .fc-event.event-tomato {
            background-color: #dc2127 !important;
            border-color: #dc2127 !important;
        }

        .fc-event.event-flamingo {
            background-color: #ff887c !important;
            border-color: #ff887c !important;
        }

        .fc-event.event-tangerine {
            background-color: #ffb878 !important;
            border-color: #ffb878 !important;
        }

        .fc-event.event-banana {
            background-color: #fbd75b !important;
            border-color: #fbd75b !important;
        }

        .fc-event.event-basil {
            background-color: #51b749 !important;
            border-color: #51b749 !important;
        }

        .fc-event.event-sage {
            background-color: #7ae7bf !important;
            border-color: #7ae7bf !important;
        }

        .fc-event.event-blueberry {
            background-color: #5484ed !important;
            border-color: #5484ed !important;
        }

        .fc-event.event-peacock {
            background-color: #46d6db !important;
            border-color: #46d6db !important;
        }

        .fc-event.event-lavender {
            background-color: #a4bdfc !important;
            border-color: #a4bdfc !important;
        }

        .fc-event.event-grape {
            background-color: #dbadff !important;
            border-color: #dbadff !important;
        }

        .fc-event.event-graphite {
            background-color: #e1e1e1 !important;
            border-color: #e1e1e1 !important;
        }

        /* ë‹¤ì¤‘ ë‚ ì§œ ì¼ì • ìŠ¤íƒ€ì¼ */
        .fc-daygrid-event-harness {
            margin: 1px 0 !important;
        }

        /* ì—°ì†ëœ ì¼ì •ì˜ ì²« ë²ˆì§¸, ì¤‘ê°„, ë§ˆì§€ë§‰ ë¶€ë¶„ ìŠ¤íƒ€ì¼ */
        .fc-event-start {
            border-top-left-radius: 4px !important;
            border-bottom-left-radius: 4px !important;
            border-top-right-radius: 0 !important;
            border-bottom-right-radius: 0 !important;
        }

        .fc-event-end {
            border-top-left-radius: 0 !important;
            border-bottom-left-radius: 0 !important;
            border-top-right-radius: 4px !important;
            border-bottom-right-radius: 4px !important;
        }

        .fc-event-start.fc-event-end {
            border-radius: 4px !important;
        }

        /* ì—°ì†ëœ ì¼ì •ì˜ ì¤‘ê°„ ë¶€ë¶„ */
        .fc-event:not(.fc-event-start):not(.fc-event-end) {
            border-radius: 0 !important;
        }

        /* Footer */
        .footer {
            background-color: #faf8f5;
            border-top: 1px solid #e8e5e0;
            padding: 40px 20px 20px;
            margin-top: 60px;
        }

        .footer-container {
            max-width: 1200px;
            margin: 0 auto;
            text-align: center;
        }

        .footer-links {
            display: flex;
            justify-content: center;
            gap: 40px;
            margin-bottom: 20px;
        }

        .footer-links a {
            text-decoration: none;
            color: #999;
            font-size: 14px;
        }

        .footer-links a:hover {
            color: #d4a574;
        }

        .social-icons {
            display: flex;
            justify-content: center;
            gap: 15px;
            margin-bottom: 20px;
        }

        .social-icon {
            width: 35px;
            height: 35px;
            border-radius: 50%;
            background-color: #e8e5e0;
            display: flex;
            align-items: center;
            justify-content: center;
            text-decoration: none;
            color: #999;
            transition: all 0.2s;
        }

        .social-icon:hover {
            background-color: #d4a574;
            color: white;
        }

        .copyright {
            color: #999;
            font-size: 12px;
        }

        /* ëª¨ë‹¬ ìŠ¤íƒ€ì¼ */
        .modal {
            display: none;
            position: fixed;
            z-index: 1000;
            left: 0;
            top: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.5);
        }

        .modal-content {
            background-color: white;
            margin: 5% auto;
            padding: 0;
            border-radius: 15px;
            width: 90%;
            max-width: 600px;
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.3);
            position: relative;
            animation: modalSlideIn 0.3s ease-out;
            max-height: 85vh;
            overflow-y: auto;
        }

        @keyframes modalSlideIn {
            from {
                transform: translateY(-50px);
                opacity: 0;
            }
            to {
                transform: translateY(0);
                opacity: 1;
            }
        }

        .modal-header {
            background-color: #d4a574;
            color: white;
            padding: 20px 25px;
            border-radius: 15px 15px 0 0;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .modal-title {
            font-size: 18px;
            font-weight: 600;
            margin: 0;
        }

        .close {
            background: none;
            border: none;
            color: white;
            font-size: 24px;
            cursor: pointer;
            padding: 0;
            width: 30px;
            height: 30px;
            display: flex;
            align-items: center;
            justify-content: center;
            border-radius: 50%;
            transition: background-color 0.2s;
        }

        .close:hover {
            background-color: rgba(255, 255, 255, 0.2);
        }

        .modal-body {
            padding: 25px;
        }

        .form-group {
            margin-bottom: 20px;
        }

        .form-group label {
            display: block;
            margin-bottom: 8px;
            font-weight: 500;
            color: #333;
        }

        .form-group label input[type="checkbox"] {
            width: auto;
            margin-right: 8px;
            margin-bottom: 0;
        }

        .form-group input,
        .form-group textarea,
        .form-group select {
            width: 100%;
            padding: 12px;
            border: 1px solid #ddd;
            border-radius: 8px;
            font-size: 14px;
            transition: border-color 0.2s;
        }

        .form-group input:focus,
        .form-group textarea:focus,
        .form-group select:focus {
            outline: none;
            border-color: #d4a574;
        }

        .form-group textarea {
            resize: vertical;
            min-height: 80px;
        }

        .form-row {
            display: flex;
            gap: 15px;
        }

        .form-row .form-group {
            flex: 1;
        }

        .color-options {
            display: flex;
            gap: 10px;
            flex-wrap: wrap;
        }

        .color-option {
            width: 30px;
            height: 30px;
            border-radius: 50%;
            border: 2px solid transparent;
            cursor: pointer;
            transition: all 0.2s;
        }

        .color-option:hover {
            transform: scale(1.1);
        }

        .color-option.selected {
            border-color: #333;
            transform: scale(1.2);
        }

        /* ìƒ‰ìƒ ì„ íƒê¸° ìŠ¤íƒ€ì¼ */
        .color-selector {
            position: relative;
        }

        .color-preview {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid #ddd;
            transition: all 0.2s;
        }

        .color-preview:hover {
            transform: scale(1.1);
            border-color: #d4a574;
        }

        /* ìƒ‰ìƒ íŒ”ë ˆíŠ¸ ìŠ¤íƒ€ì¼ */
        .color-palette {
            position: absolute;
            top: 40px;
            left: 0;
            display: grid;
            grid-template-rows: repeat(2, 1fr);
            grid-template-columns: repeat(6, 1fr);
            gap: 8px;
            background: white;
            padding: 12px;
            border-radius: 12px;
            box-shadow: 0 4px 20px rgba(0, 0, 0, 0.15);
            border: 1px solid #e0e0e0;
            z-index: 100;
        }

        .color-circle {
            width: 32px;
            height: 32px;
            border-radius: 50%;
            cursor: pointer;
            border: 2px solid transparent;
            transition: all 0.2s;
            position: relative;
            display: flex;
            align-items: center;
            justify-content: center;
        }

        .color-circle:hover {
            transform: scale(1.1);
            border-color: rgba(0, 0, 0, 0.2);
        }

        .color-circle.selected {
            border-color: #333;
            transform: scale(1.15);
        }

        .check-mark {
            color: white;
            font-size: 16px;
            font-weight: bold;
            text-shadow: 1px 1px 2px rgba(0, 0, 0, 0.5);
            display: none;
        }

        .color-circle.selected .check-mark {
            display: block;
        }

        /* ìš”ì¼ ì„ íƒ */
        .weekdays {
            display: flex;
            gap: 8px;
            flex-wrap: wrap;
        }

        .weekday-option {
            display: flex;
            align-items: center;
            justify-content: center;
            width: 40px;
            height: 40px;
            border: 1px solid #ddd;
            border-radius: 50%;
            cursor: pointer;
            font-size: 12px;
            font-weight: 500;
            transition: all 0.2s;
            user-select: none;
        }

        .weekday-option:hover {
            background-color: #e3f2fd;
            border-color: #d4a574;
        }

        .weekday-option.selected {
            background-color: #d4a574;
            border-color: #d4a574;
            color: white;
        }

        /* ì¢…ë£Œ ì¡°ê±´ */
        .end-options {
            display: flex;
            flex-direction: column;
            gap: 15px;
        }

        .end-option {
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .end-option input[type="radio"] {
            width: auto;
            margin: 0;
        }

        .end-option input[type="date"],
        .end-option input[type="number"] {
            width: 120px;
            margin-left: 10px;
            padding: 8px;
        }

        /* ìˆ¨ê¹€ ì²˜ë¦¬ */
        .hidden {
            display: none !important;
        }

        .modal-footer {
            padding: 20px 25px;
            border-top: 1px solid #eee;
            display: flex;
            justify-content: space-between;
            gap: 10px;
        }

        .btn {
            padding: 10px 20px;
            border: none;
            border-radius: 8px;
            font-size: 14px;
            font-weight: 500;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background-color: #d4a574;
            color: white;
        }

        .btn-primary:hover {
            background-color: #c19660;
        }

        .btn-secondary {
            background-color: #f8f9fa;
            color: #666;
            border: 1px solid #ddd;
        }

        .btn-secondary:hover {
            background-color: #e9ecef;
        }

        .btn-danger {
            background-color: #dc3545;
            color: white;
        }

        .btn-danger:hover {
            background-color: #c82333;
        }

        /* Responsive */
        @media (max-width: 768px) {
            .nav-menu {
                display: none;
            }

            .search-input {
                width: 150px;
            }

            .main-container {
                padding: 20px 15px;
            }

            .page-title {
                font-size: 24px;
            }

            .calendar-container {
                padding: 20px;
            }

            .footer-links {
                flex-direction: column;
                gap: 15px;
            }

            .modal-content {
                width: 95%;
                margin: 3% auto;
            }

            .form-row {
                flex-direction: column;
                gap: 10px;
            }

            .weekdays {
                justify-content: center;
            }

            .end-option {
                flex-direction: column;
                align-items: flex-start;
                gap: 8px;
            }

            .end-option input[type="date"],
            .end-option input[type="number"] {
                margin-left: 0;
                width: 100%;
            }
        }
    </style>
</head>
<body>

<!-- Header -->
<header>
    <nav>
        <a href="/" class="logo">PETORY</a>
        <ul class="nav-links">
            <li><a href="/community">ì»¤ë®¤ë‹ˆí‹°</a></li>
            <li><a href="/market">ë§ˆì¼“í”Œë ˆì´ìŠ¤</a></li>
            <li><a href="/petPlace">í«í”Œë ˆì´ìŠ¤</a></li>
            <li><a href="/myCalendar">ë§ˆì´í˜ì´ì§€</a></li>
        </ul>
        <div class="auth-buttons">
            <a href="/login" class="btn btn-outline">ë¡œê·¸ì¸</a>
            <a href="/login" class="btn btn-primary">íšŒì›ê°€ì…</a>
        </div>
    </nav>
</header>

<!-- Main Content -->
<main class="main-container">
    <h1 class="page-title">ë§ˆì´ í˜ì´ì§€</h1>

    <!-- Tab Navigation -->
    <div class="tab-nav">
        <button class="tab-item">ì‚¬ì§„ ê¸°ë¡</button>
        <button class="tab-item">ì§ˆë¬¸ ê¸°ë¡</button>
        <button class="tab-item active">ìº˜ë¦°ë”</button>
        <button class="tab-item">ê¸‰ì—¬ëŸ‰ ê³„ì‚°</button>
    </div>

    <!-- Calendar -->
    <div class="calendar-container">
        <div id="calendar"></div>
    </div>
</main>

<!-- Footer -->
<footer class="footer">
    <div class="footer-container">
        <div class="footer-links">
            <a href="#">About Us</a>
            <a href="#">Contact</a>
            <a href="#">Terms of Service</a>
        </div>
        <div class="social-icons">
            <a href="#" class="social-icon">ğŸ¦</a>
            <a href="#" class="social-icon">ğŸ“·</a>
            <a href="#" class="social-icon">ğŸ“˜</a>
        </div>
        <div class="copyright">
            Â©2025 Petory. All rights reserved.
        </div>
    </div>
</footer>

<!-- ì¼ì • ëª¨ë‹¬ -->
<div id="eventModal" class="modal">
    <div class="modal-content">
        <div class="modal-header">
            <h3 class="modal-title" id="modalTitle">ìƒˆ ì¼ì • ì¶”ê°€</h3>
            <button class="close" id="closeModal">&times;</button>
        </div>
        <div class="modal-body">
            <form id="eventForm">
                <div class="form-group">
                    <label for="eventTitle">ì¼ì • ì œëª© *</label>
                    <input type="text" id="eventTitle" required placeholder="ì¼ì • ì œëª©ì„ ì…ë ¥í•˜ì„¸ìš”">
                </div>

                <div class="form-row">
                    <div class="form-group">
                        <label for="eventStartDate">ì‹œì‘ì¼ *</label>
                        <input type="date" id="eventStartDate" required>
                        <input type="datetime-local" id="eventStartDateTime" style="display: none;">
                    </div>
                    <div class="form-group">
                        <label for="eventEndDate">ì¢…ë£Œì¼ *</label>
                        <input type="date" id="eventEndDate" required>
                        <input type="datetime-local" id="eventEndDateTime" style="display: none;">
                    </div>
                </div>

                <div class="form-group">
                    <label>
                        <input type="checkbox" id="allDayEvent" checked> í•˜ë£¨ ì¢…ì¼
                    </label>
                </div>

                <!-- ë°˜ë³µ ìœ í˜• ì„ íƒ -->
                <div class="form-group">
                    <label for="repeatType">ë°˜ë³µ ìœ í˜•</label>
                    <select id="repeatType">
                        <option value="none">ë°˜ë³µ ì•ˆí•¨</option>
                        <option value="daily">ë§¤ì¼</option>
                        <option value="weekly">ë§¤ì£¼</option>
                        <option value="monthly">ë§¤ì›”</option>
                        <option value="yearly">ë§¤ë…„</option>
                        <option value="custom">ì‚¬ìš©ì ì •ì˜</option>
                    </select>
                </div>

                <!-- ì‚¬ìš©ì ì •ì˜ ì„¤ì • ì˜ì—­ -->
                <div id="customSettings" class="hidden">
                    <!-- ë°˜ë³µ ì£¼ê¸° -->
                    <div class="form-row">
                        <div class="form-group">
                            <label for="customInterval">ë°˜ë³µ ê°„ê²©</label>
                            <input type="number" id="customInterval" value="1" min="1" max="999">
                        </div>
                        <div class="form-group">
                            <label for="customFreq">ë‹¨ìœ„</label>
                            <select id="customFreq">
                                <option value="DAILY">ì¼</option>
                                <option value="WEEKLY">ì£¼</option>
                                <option value="MONTHLY">ê°œì›”</option>
                                <option value="YEARLY">ë…„</option>
                            </select>
                        </div>
                    </div>

                    <!-- ìš”ì¼ ì„ íƒ (ì£¼ê°„ ë°˜ë³µì¼ ë•Œë§Œ) -->
                    <div id="customWeekdaySection" class="form-group">
                        <label>ë°˜ë³µ ìš”ì¼</label>
                        <div class="weekdays">
                            <div class="weekday-option" data-day="SU">ì¼</div>
                            <div class="weekday-option" data-day="MO">ì›”</div>
                            <div class="weekday-option selected" data-day="TU">í™”</div>
                            <div class="weekday-option" data-day="WE">ìˆ˜</div>
                            <div class="weekday-option" data-day="TH">ëª©</div>
                            <div class="weekday-option" data-day="FR">ê¸ˆ</div>
                            <div class="weekday-option" data-day="SA">í† </div>
                        </div>
                    </div>

                    <!-- ì¢…ë£Œ ì¡°ê±´ -->
                    <div class="form-group">
                        <label>ì¢…ë£Œ ì¡°ê±´</label>
                        <div class="end-options">
                            <div class="end-option">
                                <input type="radio" name="customEndType" value="never" checked>
                                <label>ì¢…ë£Œí•˜ì§€ ì•ŠìŒ</label>
                            </div>
                            <div class="end-option">
                                <input type="radio" name="customEndType" value="until">
                                <label>ë‹¤ìŒ ë‚ ì§œê¹Œì§€:</label>
                                <input type="date" id="customUntilDate" disabled>
                            </div>
                            <div class="end-option">
                                <input type="radio" name="customEndType" value="count">
                                <label>ë‹¤ìŒ íšŸìˆ˜ë§Œí¼:</label>
                                <input type="number" id="customCount" value="10" min="1" max="999" disabled>
                                <span>íšŒ</span>
                            </div>
                        </div>
                    </div>
                </div>

                <div class="form-group">
                    <label for="eventMemo">ë©”ëª¨</label>
                    <textarea id="eventMemo" placeholder="ë©”ëª¨ë¥¼ ì…ë ¥í•˜ì„¸ìš”"></textarea>
                </div>

                <div class="form-group">
                    <label>ìƒ‰ìƒ</label>
                    <div class="color-selector">
                        <div class="color-preview" id="colorPreview" data-color="BLUEBERRY"
                             style="background-color: #5484ed;">
                        </div>
                        <div class="color-palette" id="colorPalette" style="display: none;">
                            <div class="color-circle" data-color="TOMATO" style="background-color: #dc2127;"></div>
                            <div class="color-circle" data-color="FLAMINGO" style="background-color: #ff887c;"></div>
                            <div class="color-circle" data-color="TANGERINE" style="background-color: #ffb878;"></div>
                            <div class="color-circle" data-color="BANANA" style="background-color: #fbd75b;"></div>
                            <div class="color-circle" data-color="BASIL" style="background-color: #51b749;"></div>
                            <div class="color-circle" data-color="SAGE" style="background-color: #7ae7bf;"></div>
                            <div class="color-circle selected" data-color="BLUEBERRY"
                                 style="background-color: #5484ed;">
                                <div class="check-mark">âœ“</div>
                            </div>
                            <div class="color-circle" data-color="PEACOCK" style="background-color: #46d6db;"></div>
                            <div class="color-circle" data-color="LAVENDER" style="background-color: #a4bdfc;"></div>
                            <div class="color-circle" data-color="GRAPE" style="background-color: #dbadff;"></div>
                            <div class="color-circle" data-color="GRAPHITE" style="background-color: #e1e1e1;"></div>
                        </div>
                    </div>
                </div>
            </form>
        </div>
        <div class="modal-footer">
            <div>
                <button type="button" class="btn btn-danger" id="deleteEvent" style="display: none;">ì‚­ì œ</button>
            </div>
            <div style="display: flex; gap: 10px;">
                <button type="button" class="btn btn-secondary" id="cancelModal">ì·¨ì†Œ</button>
                <button type="button" class="btn btn-primary" id="saveEvent">ì €ì¥</button>
            </div>
        </div>
    </div>
</div>

<!-- FullCalendar JS -->
<script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.11.5/main.min.js'></script>
<script src='https://cdnjs.cloudflare.com/ajax/libs/fullcalendar/5.11.5/locales/ko.min.js'></script>

<script>
    // API ì„¤ì •
    const API_BASE_URL = '/users/events'; // ë°±ì—”ë“œ API ê¸°ë³¸ URL
    const ACCESS_TOKEN = 'Bearer ' + 'eyJhbGciOiJIUzI1NiJ9.eyJzdWIiOiIxIiwiZW1haWwiOiJqY3NjZW5lQGdtYWlsLmNvbSIsIm5pY2tuYW1lIjoiSmVzc2ljYSBLaW0iLCJyb2xlcyI6WyJST0xFX0FETUlOIiwiUk9MRV9VU0VSIl0sImV4cCI6MTc1MTgxMDg4NiwiaWF0IjoxNzUxODA3Mjg2fQ.8eWNaBXb5eiHGxqlou5RwgppUUY4N4UgOj_dXFmToKk'; // í•˜ë“œì½”ë”©ëœ Access Token

    // API ìš”ì²­ í—¬í¼ í•¨ìˆ˜
    async function apiRequest(url, method = 'GET', data = null) {
        const options = {
            method: method,
            headers: {
                'Content-Type': 'application/json',
                'Authorization': ACCESS_TOKEN
            }
        };

        if (data) {
            options.body = JSON.stringify(data);
        }

        try {
            console.log(`API ìš”ì²­: ${method} ${url}`, data ? data : '');

            const response = await fetch(url, options);

            // ì‘ë‹µ í…ìŠ¤íŠ¸ë¥¼ ë¨¼ì € ê°€ì ¸ì™€ì„œ ë¡œê¹…
            const responseText = await response.text();
            console.log('ì„œë²„ ì‘ë‹µ:', responseText);

            if (!response.ok) {
                let errorMessage = `HTTP error! status: ${response.status}`;
                try {
                    const errorData = JSON.parse(responseText);
                    errorMessage = errorData.message || errorMessage;
                } catch (parseError) {
                    console.error('ì—ëŸ¬ ì‘ë‹µ JSON íŒŒì‹± ì‹¤íŒ¨:', parseError);
                    errorMessage = responseText || errorMessage;
                }
                throw new Error(errorMessage);
            }

            // ë¹ˆ ì‘ë‹µ ì²´í¬ (DELETE ìš”ì²­ì˜ ê²½ìš°)
            if (!responseText.trim()) {
                return {};
            }

            // JSON íŒŒì‹± ì‹œë„
            try {
                return JSON.parse(responseText);
            } catch (parseError) {
                console.error('ì‘ë‹µ JSON íŒŒì‹± ì‹¤íŒ¨:', parseError);
                console.error('ì‘ë‹µ ë‚´ìš©:', responseText);
                throw new Error('ì„œë²„ ì‘ë‹µì„ íŒŒì‹±í•  ìˆ˜ ì—†ìŠµë‹ˆë‹¤: ' + parseError.message);
            }
        } catch (error) {
            console.error('API ìš”ì²­ ì‹¤íŒ¨:', error);
            alert('ì„œë²„ ìš”ì²­ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤: ' + error.message);
            throw error;
        }
    }

    // ìƒ‰ìƒ enumì„ hex ê°’ìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ë§µ
    const COLOR_MAP = {
        'LAVENDER': '#a4bdfc',
        'SAGE': '#7ae7bf',
        'GRAPE': '#dbadff',
        'FLAMINGO': '#ff887c',
        'BANANA': '#fbd75b',
        'TANGERINE': '#ffb878',
        'PEACOCK': '#46d6db',
        'GRAPHITE': '#e1e1e1',
        'BLUEBERRY': '#5484ed',
        'BASIL': '#51b749',
        'TOMATO': '#dc2127'
    };

    // hex ê°’ì„ ìƒ‰ìƒ enumìœ¼ë¡œ ë³€í™˜í•˜ëŠ” ì—­ë°©í–¥ ë§µ
    const HEX_TO_COLOR_MAP = Object.fromEntries(
        Object.entries(COLOR_MAP).map(([key, value]) => [value, key])
    );

    // ë‚ ì§œ í¬ë§· ë³€í™˜ í•¨ìˆ˜ë“¤
    function formatDateForAPI(dateStr, isAllDay = true) {
        if (!dateStr) return null;

        if (isAllDay) {
            // í•˜ë£¨ ì¢…ì¼ ì´ë²¤íŠ¸ì˜ ê²½ìš° ë‚ ì§œë§Œ ì‚¬ìš©
            return dateStr + 'T00:00:00';
        } else {
            // ì‹œê°„ì´ í¬í•¨ëœ ê²½ìš° ê·¸ëŒ€ë¡œ ì‚¬ìš©
            return dateStr.includes('T') ? dateStr + ':00' : dateStr + 'T00:00:00';
        }
    }

    function formatDateFromAPI(dateStr) {
        if (!dateStr) return null;
        return dateStr.split('T')[0];
    }

    function formatDateTimeFromAPI(dateStr) {
        if (!dateStr) return null;
        return dateStr.substring(0, 16); // YYYY-MM-DDTHH:mm í˜•íƒœë¡œ ë°˜í™˜
    }

    // RRULE íŒŒì‹± í•¨ìˆ˜ ì¶”ê°€
    function parseRRule(rruleArray) {
        if (!rruleArray || rruleArray.length === 0) {
            return {
                type: 'none',
                freq: null,
                interval: 1,
                weekdays: [],
                endType: 'never',
                untilDate: null,
                count: null
            };
        }

        const rruleString = rruleArray[0]; // ì²« ë²ˆì§¸ RRULEë§Œ ì²˜ë¦¬
        console.log('íŒŒì‹±í•  RRULE:', rruleString);

        // RRULE íŒŒë¼ë¯¸í„° íŒŒì‹±
        const params = {};
        const parts = rruleString.replace('RRULE:', '').split(';');

        parts.forEach(part => {
            const [key, value] = part.split('=');
            if (key && value) {
                params[key] = value;
            }
        });

        console.log('íŒŒì‹±ëœ RRULE íŒŒë¼ë¯¸í„°:', params);

        const result = {
            type: 'custom',
            freq: params.FREQ || 'WEEKLY',
            interval: parseInt(params.INTERVAL) || 1,
            weekdays: params.BYDAY ? params.BYDAY.split(',') : [],
            endType: 'never',
            untilDate: null,
            count: null
        };

        // ì¢…ë£Œ ì¡°ê±´ í™•ì¸
        if (params.UNTIL) {
            result.endType = 'until';
            // UNTIL í˜•íƒœ: 20251231 -> 2025-12-31
            const untilStr = params.UNTIL;
            if (untilStr.length === 8) {
                result.untilDate = `${untilStr.substr(0, 4)}-${untilStr.substr(4, 2)}-${untilStr.substr(6, 2)}`;
            }
        } else if (params.COUNT) {
            result.endType = 'count';
            result.count = parseInt(params.COUNT);
        }

        // ê¸°ë³¸ ë°˜ë³µ ìœ í˜• ê°ì§€
        if (result.freq === 'DAILY' && result.interval === 1 && !params.BYDAY) {
            result.type = 'daily';
        } else if (result.freq === 'WEEKLY' && result.interval === 1 && result.weekdays.length === 1) {
            result.type = 'weekly';
        } else if (result.freq === 'MONTHLY' && result.interval === 1 && params.BYDAY && params.BYDAY.match(/^\d+[A-Z]{2}$/)) {
            result.type = 'monthly';
        } else if (result.freq === 'YEARLY' && result.interval === 1 && params.BYMONTH && params.BYMONTHDAY) {
            result.type = 'yearly';
        }

        console.log('íŒŒì‹± ê²°ê³¼:', result);
        return result;
    }

    // ë°˜ë³µ ì„¤ì •ì„ UIì— ë³µì›í•˜ëŠ” í•¨ìˆ˜
    function restoreRepeatSettings(rruleArray) {
        const parsed = parseRRule(rruleArray);

        // ë°˜ë³µ ìœ í˜• ì„¤ì •
        document.getElementById('repeatType').value = parsed.type;

        if (parsed.type === 'custom') {
            // ì‚¬ìš©ì ì •ì˜ ì„¤ì • í‘œì‹œ
            document.getElementById('customSettings').classList.remove('hidden');

            // ê°„ê²©ê³¼ ì£¼ê¸° ì„¤ì •
            document.getElementById('customInterval').value = parsed.interval;
            document.getElementById('customFreq').value = parsed.freq;

            // ìš”ì¼ ì„¤ì • (ì£¼ê°„ ë°˜ë³µì¸ ê²½ìš°)
            document.querySelectorAll('.weekday-option').forEach(day => {
                day.classList.remove('selected');
                if (parsed.weekdays.includes(day.dataset.day)) {
                    day.classList.add('selected');
                }
            });

            // ì¢…ë£Œ ì¡°ê±´ ì„¤ì •
            document.querySelector(`input[name="customEndType"][value="${parsed.endType}"]`).checked = true;

            if (parsed.endType === 'until' && parsed.untilDate) {
                document.getElementById('customUntilDate').value = parsed.untilDate;
            } else if (parsed.endType === 'count' && parsed.count) {
                document.getElementById('customCount').value = parsed.count;
            }

            // ìš”ì¼ ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¹€ ë° í•„ë“œ í™œì„±í™” ìƒíƒœ ì—…ë°ì´íŠ¸
            updateWeekdayVisibility();
            updateEndFields();
        } else {
            // ê¸°ë³¸ ë°˜ë³µ ìœ í˜•ì¸ ê²½ìš° ì‚¬ìš©ì ì •ì˜ ì„¤ì • ìˆ¨ê¹€
            document.getElementById('customSettings').classList.add('hidden');
        }
    }

    document.addEventListener('DOMContentLoaded', function () {
        var calendarEl = document.getElementById('calendar');
        var modal = document.getElementById('eventModal');
        var modalTitle = document.getElementById('modalTitle');
        var eventForm = document.getElementById('eventForm');
        var currentEvent = null;
        var selectedDate = null;
        var currentRRule = '';

        var calendar = new FullCalendar.Calendar(calendarEl, {
            initialView: 'dayGridMonth',
            headerToolbar: {
                left: 'prevYear,prev,next,nextYear today',
                center: 'title',
                right: 'dayGridMonth,dayGridWeek,dayGridDay,listWeek'
            },
            locale: 'ko',
            height: 'auto',
            dayMaxEvents: true,
            selectable: true,
            selectMirror: true,
            fixedWeekCount: false,
            showNonCurrentDates: true,

            events: async function (info, successCallback, failureCallback) {
                try {
                    const start = info.startStr.split('T')[0];
                    const end = info.endStr.split('T')[0];

                    const response = await apiRequest(`${API_BASE_URL}?start=${start}&end=${end}`);

                    const events = response.data.map(event => {
                        return {
                            id: event.id,
                            title: event.title,
                            start: event.startDate,
                            end: event.endDate, // ë°±ì—”ë“œì—ì„œ ì´ë¯¸ ì²˜ë¦¬ëœ ì¢…ë£Œì¼ ê·¸ëŒ€ë¡œ ì‚¬ìš©
                            allDay: event.isAllDay,
                            backgroundColor: COLOR_MAP[event.color] || '#5484ed',
                            borderColor: COLOR_MAP[event.color] || '#5484ed',
                            textColor: 'white',
                            className: `event-${(event.color || 'BLUEBERRY').toLowerCase()}`, // CSS í´ë˜ìŠ¤ ì¶”ê°€
                            extendedProps: {
                                colorEnum: event.color,
                                originalEvent: event
                            }
                        };
                    });

                    successCallback(events);
                } catch (error) {
                    console.error('ì¼ì • ë¡œë“œ ì‹¤íŒ¨:', error);
                    // 401 ì—ëŸ¬ë‚˜ ê¸°íƒ€ ì—ëŸ¬ ë°œìƒì‹œ ë¹ˆ ë°°ì—´ ë°˜í™˜
                    successCallback([]);
                }
            },

            // ë‚ ì§œ í´ë¦­/ë“œë˜ê·¸ ì„ íƒ
            select: function (info) {
                const startDateStr = info.startStr;
                const endDateObj = new Date(info.endStr || info.end);
                endDateObj.setDate(endDateObj.getDate() - 1);

                const year = endDateObj.getFullYear();
                const month = String(endDateObj.getMonth() + 1).padStart(2, '0');
                const day = String(endDateObj.getDate()).padStart(2, '0');
                const endDateStr = `${year}-${month}-${day}`;

                openModal('create', startDateStr, null, endDateStr);
                calendar.unselect();
            },

            // ë‚ ì§œ í´ë¦­ (ë‹¨ì¼)
            dateClick: function (info) {
                openModal('create', info.dateStr);
            },

            // ì´ë²¤íŠ¸ í´ë¦­
            eventClick: function (info) {
                openModal('edit', null, info.event);
            }
        });

        calendar.render();

        // ëª¨ë‹¬ ì—´ê¸° í•¨ìˆ˜
        async function openModal(mode, startDate, event, endDate) {
            currentEvent = event || null;
            selectedDate = startDate;

            if (mode === 'create') {
                modalTitle.textContent = 'ìƒˆ ì¼ì • ì¶”ê°€';
                document.getElementById('deleteEvent').style.display = 'none';
                resetForm();
                document.getElementById('eventStartDate').value = startDate;
                document.getElementById('eventEndDate').value = endDate || startDate;
                updateRepeatTexts(startDate);
            } else {
                modalTitle.textContent = 'ì¼ì • ìˆ˜ì •';
                document.getElementById('deleteEvent').style.display = 'block';

                try {
                    // ì„œë²„ì—ì„œ ìƒì„¸ ì •ë³´ ê°€ì ¸ì˜¤ê¸°
                    const response = await apiRequest(`${API_BASE_URL}/${event.id}`);
                    fillForm(event, response.data);
                    const eventStartDate = response.data.startDate.split('T')[0];
                    updateRepeatTexts(eventStartDate);
                } catch (error) {
                    console.error('ì¼ì • ìƒì„¸ ì •ë³´ ë¡œë“œ ì‹¤íŒ¨:', error);
                    // ì‹¤íŒ¨ì‹œ ê¸°ë³¸ ì •ë³´ë¡œ í¼ ì±„ìš°ê¸° (FullCalendarì—ì„œ ì œê³µí•˜ëŠ” ê¸°ë³¸ ì •ë³´ ì‚¬ìš©)
                    fillForm(event, {
                        title: event.title,
                        startDate: event.startStr,
                        endDate: event.endStr,
                        isAllDay: event.allDay,
                        description: '',
                        color: event.extendedProps.colorEnum || 'BLUEBERRY',
                        recurrence: []
                    });
                    const eventStartDate = event.startStr.split('T')[0];
                    updateRepeatTexts(eventStartDate);
                }
            }

            modal.style.display = 'block';
            document.getElementById('eventTitle').focus();
        }

        // í¼ ì´ˆê¸°í™”
        function resetForm() {
            eventForm.reset();
            document.getElementById('allDayEvent').checked = true;
            document.getElementById('eventStartDate').style.display = 'block';
            document.getElementById('eventEndDate').style.display = 'block';
            document.getElementById('eventStartDateTime').style.display = 'none';
            document.getElementById('eventEndDateTime').style.display = 'none';

            // ìƒ‰ìƒì„ BLUEBERRYë¡œ ì´ˆê¸°í™”
            const colorPreview = document.getElementById('colorPreview');
            colorPreview.dataset.color = 'BLUEBERRY';
            colorPreview.style.backgroundColor = '#5484ed';

            document.querySelectorAll('.color-circle').forEach(circle => {
                circle.classList.remove('selected');
            });
            document.querySelector('.color-circle[data-color="BLUEBERRY"]').classList.add('selected');

            // ë°˜ë³µ ì„¤ì • ì´ˆê¸°í™”
            resetRepeatSettings();
        }

        // ë°˜ë³µ ì„¤ì • ì´ˆê¸°í™”
        function resetRepeatSettings() {
            document.getElementById('repeatType').value = 'none';
            document.getElementById('customSettings').classList.add('hidden');
            document.getElementById('customInterval').value = 1;
            document.getElementById('customFreq').value = 'WEEKLY';

            document.querySelectorAll('.weekday-option').forEach(day => {
                day.classList.remove('selected');
            });

            document.querySelector('input[name="customEndType"][value="never"]').checked = true;
            document.getElementById('customUntilDate').value = '';
            document.getElementById('customCount').value = 10;

            updateWeekdayVisibility();
            updateEndFields();
            generateRRule();
        }

        // í¼ ì±„ìš°ê¸° (ìˆ˜ì • ëª¨ë“œ)
        function fillForm(event, eventDetail) {
            const data = eventDetail || event.extendedProps.originalEvent;

            document.getElementById('eventTitle').value = data.title || event.title;

            let startDate = data.startDate ? data.startDate.split('T')[0] : event.startStr.split('T')[0];
            let endDate = data.endDate ? data.endDate.split('T')[0] : (event.endStr ? event.endStr.split('T')[0] : startDate);

            if (data.isAllDay !== false) {
                const endDateObj = new Date(endDate);
                endDateObj.setDate(endDateObj.getDate() - 1);
                endDate = endDateObj.toISOString().split('T')[0];
            }

            // ì‹œê°„ì´ ìˆëŠ”ì§€ í™•ì¸
            const hasTime = data.isAllDay === false;
            document.getElementById('allDayEvent').checked = data.isAllDay !== false;

            if (hasTime) {
                // ì‹œê°„ í¬í•¨ ëª¨ë“œ
                document.getElementById('eventStartDate').style.display = 'none';
                document.getElementById('eventEndDate').style.display = 'none';
                document.getElementById('eventStartDateTime').style.display = 'block';
                document.getElementById('eventEndDateTime').style.display = 'block';

                document.getElementById('eventStartDateTime').value = formatDateTimeFromAPI(data.startDate || event.startStr);
                if (data.endDate || event.endStr) {
                    document.getElementById('eventEndDateTime').value = formatDateTimeFromAPI(data.endDate || event.endStr);
                }
            } else {
                // í•˜ë£¨ ì¢…ì¼ ëª¨ë“œ
                document.getElementById('eventStartDate').style.display = 'block';
                document.getElementById('eventEndDate').style.display = 'block';
                document.getElementById('eventStartDateTime').style.display = 'none';
                document.getElementById('eventEndDateTime').style.display = 'none';

                document.getElementById('eventStartDate').value = startDate;
                document.getElementById('eventEndDate').value = endDate;
            }

            document.getElementById('eventMemo').value = data.description || '';

            // ìƒ‰ìƒ ì„ íƒ
            const eventColorEnum = data.color || event.extendedProps.colorEnum || 'BLUEBERRY';
            const colorPreview = document.getElementById('colorPreview');
            colorPreview.dataset.color = eventColorEnum;
            colorPreview.style.backgroundColor = COLOR_MAP[eventColorEnum];

            document.querySelectorAll('.color-circle').forEach(circle => {
                circle.classList.remove('selected');
                if (circle.dataset.color === eventColorEnum) {
                    circle.classList.add('selected');
                }
            });

            // ë°˜ë³µ ì„¤ì • ë³µì› - ì—¬ê¸°ê°€ í•µì‹¬!
            if (data.recurrence && data.recurrence.length > 0) {
                console.log('ë°˜ë³µ ì„¤ì • ë³µì› ì‹œì‘:', data.recurrence);
                restoreRepeatSettings(data.recurrence);
            } else {
                console.log('ë°˜ë³µ ì„¤ì • ì—†ìŒ, ê¸°ë³¸ê°’ìœ¼ë¡œ ì„¤ì •');
                resetRepeatSettings();
            }

            generateRRule();
        }

        // ëª¨ë‹¬ ë‹«ê¸°
        function closeModal() {
            modal.style.display = 'none';
            currentEvent = null;
            selectedDate = null;
        }

        // ë‚ ì§œ ê¸°ë°˜ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        function updateRepeatTexts(dateStr) {
            if (!dateStr) return;

            const date = new Date(dateStr);
            const weekdays = ['ì¼ìš”ì¼', 'ì›”ìš”ì¼', 'í™”ìš”ì¼', 'ìˆ˜ìš”ì¼', 'ëª©ìš”ì¼', 'ê¸ˆìš”ì¼', 'í† ìš”ì¼'];
            const months = ['1ì›”', '2ì›”', '3ì›”', '4ì›”', '5ì›”', '6ì›”', '7ì›”', '8ì›”', '9ì›”', '10ì›”', '11ì›”', '12ì›”'];

            const dayOfWeek = weekdays[date.getDay()];
            const month = months[date.getMonth()];
            const dayOfMonth = date.getDate();

            // ì£¼ì°¨ ê³„ì‚°
            const firstDayOfMonth = new Date(date.getFullYear(), date.getMonth(), 1);
            let weekOfMonth = 1;
            let checkDate = new Date(firstDayOfMonth);

            while (checkDate.getDay() !== date.getDay()) {
                checkDate.setDate(checkDate.getDate() + 1);
            }

            while (checkDate.getDate() < date.getDate()) {
                checkDate.setDate(checkDate.getDate() + 7);
                weekOfMonth++;
            }

            const weekNames = ['ì²« ë²ˆì§¸', 'ë‘ ë²ˆì§¸', 'ì„¸ ë²ˆì§¸', 'ë„¤ ë²ˆì§¸', 'ë‹¤ì„¯ ë²ˆì§¸'];
            const weekName = weekNames[weekOfMonth - 1] || 'ë§ˆì§€ë§‰';

            // ë“œë¡­ë‹¤ìš´ ì˜µì…˜ ì—…ë°ì´íŠ¸
            const repeatSelect = document.getElementById('repeatType');
            const currentValue = repeatSelect.value;

            repeatSelect.options[2].text = `ë§¤ì£¼ ${dayOfWeek}`;
            repeatSelect.options[3].text = `ë§¤ì›” ${weekName} ${dayOfWeek}`;
            repeatSelect.options[4].text = `ë§¤ë…„ ${month} ${dayOfMonth}ì¼`;

            // í˜„ì¬ ì„ íƒê°’ ìœ ì§€
            repeatSelect.value = currentValue;

            // ì‚¬ìš©ì ì •ì˜ ì„¤ì •ì—ì„œ ìš”ì¼ ì„ íƒ ì—…ë°ì´íŠ¸
            const weekDays = ['SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'];
            const currentDay = weekDays[date.getDay()];

            // ê¸°ì¡´ ì„ íƒëœ ìš”ì¼ì´ ì—†ë‹¤ë©´ í˜„ì¬ ë‚ ì§œì˜ ìš”ì¼ì„ ì„ íƒ
            const selectedWeekdays = document.querySelectorAll('.weekday-option.selected');
            if (selectedWeekdays.length === 0 || (selectedWeekdays.length === 1 && !document.querySelector('.weekday-option.selected[data-day="' + currentDay + '"]'))) {
                document.querySelectorAll('.weekday-option').forEach(day => {
                    day.classList.remove('selected');
                    if (day.dataset.day === currentDay) {
                        day.classList.add('selected');
                    }
                });
            }
        }

        // ì‚¬ìš©ì ì •ì˜ ì„¤ì • ì´ˆê¸°í™”
        function initializeCustomSettings() {
            const startDateStr = document.getElementById('eventStartDate').value || selectedDate;
            updateRepeatTexts(startDateStr);

            // ê¸°ë³¸ê°’ ì„¤ì •
            document.getElementById('customInterval').value = 1;
            document.getElementById('customFreq').value = 'WEEKLY';

            // ì¢…ë£Œ ì¡°ê±´ ì´ˆê¸°í™”
            document.querySelector('input[name="customEndType"][value="never"]').checked = true;
            document.getElementById('customUntilDate').value = '';
            document.getElementById('customCount').value = 10;

            updateWeekdayVisibility();
            updateEndFields();
        }

        // ìš”ì¼ ì„¹ì…˜ í‘œì‹œ/ìˆ¨ê¹€
        function updateWeekdayVisibility() {
            const freq = document.getElementById('customFreq').value;
            const weekdaySection = document.getElementById('customWeekdaySection');

            if (freq === 'WEEKLY') {
                weekdaySection.classList.remove('hidden');
            } else {
                weekdaySection.classList.add('hidden');
            }
        }

        // ì¢…ë£Œ í•„ë“œ í™œì„±í™”/ë¹„í™œì„±í™”
        function updateEndFields() {
            const endType = document.querySelector('input[name="customEndType"]:checked').value;

            document.getElementById('customUntilDate').disabled = endType !== 'until';
            document.getElementById('customCount').disabled = endType !== 'count';
        }

        // RRULE ìƒì„±
        function generateRRule() {
            const repeatType = document.getElementById('repeatType').value;
            const startDateInput = document.getElementById('eventStartDate');
            const startDateStr = startDateInput.value || selectedDate || '2025-07-01';
            const startDate = new Date(startDateStr);

            let rrule = '';

            // DTSTART ì¶”ê°€
            const dtstart = `DTSTART:${startDateStr.replace(/-/g, '')}`;

            if (repeatType === 'none') {
                rrule = dtstart;
            } else if (repeatType === 'daily') {
                rrule = `${dtstart}\nRRULE:FREQ=DAILY`;
            } else if (repeatType === 'weekly') {
                const weekDays = ['SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'];
                const dayCode = weekDays[startDate.getDay()];
                rrule = `${dtstart}\nRRULE:FREQ=WEEKLY;BYDAY=${dayCode}`;
            } else if (repeatType === 'monthly') {
                const firstDayOfMonth = new Date(startDate.getFullYear(), startDate.getMonth(), 1);
                let weekOfMonth = 1;
                let checkDate = new Date(firstDayOfMonth);

                while (checkDate.getDay() !== startDate.getDay()) {
                    checkDate.setDate(checkDate.getDate() + 1);
                }

                while (checkDate.getDate() < startDate.getDate()) {
                    checkDate.setDate(checkDate.getDate() + 7);
                    weekOfMonth++;
                }

                const weekDays = ['SU', 'MO', 'TU', 'WE', 'TH', 'FR', 'SA'];
                const dayCode = weekDays[startDate.getDay()];
                rrule = `${dtstart}\nRRULE:FREQ=MONTHLY;BYDAY=${weekOfMonth}${dayCode}`;
            } else if (repeatType === 'yearly') {
                const month = startDate.getMonth() + 1;
                const day = startDate.getDate();
                rrule = `${dtstart}\nRRULE:FREQ=YEARLY;BYMONTH=${month};BYMONTHDAY=${day}`;
            } else if (repeatType === 'custom') {
                const result = generateCustomRRule(dtstart);
                rrule = result.rrule;
            }

            currentRRule = rrule;
        }

        // ì‚¬ìš©ì ì •ì˜ RRULE ìƒì„±
        function generateCustomRRule(dtstart) {
            const interval = parseInt(document.getElementById('customInterval').value) || 1;
            const freq = document.getElementById('customFreq').value;
            const selectedWeekdays = Array.from(document.querySelectorAll('.weekday-option.selected'))
                .map(day => day.dataset.day);
            const endType = document.querySelector('input[name="customEndType"]:checked').value;
            const untilDate = document.getElementById('customUntilDate').value;
            const count = parseInt(document.getElementById('customCount').value);

            let rrule = `${dtstart}\nRRULE:FREQ=${freq}`;

            if (interval > 1) {
                rrule += `;INTERVAL=${interval}`;
            }

            // ì£¼ê°„ ë°˜ë³µì‹œ ìš”ì¼ ì„¤ì •
            if (freq === 'WEEKLY' && selectedWeekdays.length > 0) {
                rrule += `;BYDAY=${selectedWeekdays.join(',')}`;
            }

            // ì¢…ë£Œ ì¡°ê±´
            if (endType === 'until' && untilDate) {
                rrule += `;UNTIL=${untilDate.replace(/-/g, '')}`;
            } else if (endType === 'count' && count) {
                rrule += `;COUNT=${count}`;
            }

            return {rrule};
        }

        // ë°˜ë³µ ì¡°ê±´ì„ API í˜•íƒœë¡œ ë³€í™˜
        function buildRecurrenceArray() {
            const repeatType = document.getElementById('repeatType').value;

            if (repeatType === 'none') {
                return [];
            }

            const recurrence = [];
            const rruleOnly = currentRRule.split('\n').find(line => line.startsWith('RRULE:'));

            if (rruleOnly) {
                recurrence.push(rruleOnly);
            }

            return recurrence;
        }

        // ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆë“¤
        document.getElementById('closeModal').addEventListener('click', closeModal);
        document.getElementById('cancelModal').addEventListener('click', closeModal);

        // ëª¨ë‹¬ ë°°ê²½ í´ë¦­ì‹œ ë‹«ê¸°
        modal.addEventListener('click', function (e) {
            if (e.target === modal) {
                closeModal();
            }
        });

        // ìƒ‰ìƒ ì„ íƒê¸° ì´ë²¤íŠ¸
        document.getElementById('colorPreview').addEventListener('click', function () {
            const palette = document.getElementById('colorPalette');
            palette.style.display = palette.style.display === 'none' ? 'grid' : 'none';
        });

        // ìƒ‰ìƒ ì„ íƒ ì´ë²¤íŠ¸
        document.querySelectorAll('.color-circle').forEach(circle => {
            circle.addEventListener('click', function () {
                const colorEnum = this.dataset.color;
                const colorHex = this.style.backgroundColor;
                const colorPreview = document.getElementById('colorPreview');

                // í”„ë¦¬ë·° ì—…ë°ì´íŠ¸
                colorPreview.dataset.color = colorEnum;
                colorPreview.style.backgroundColor = colorHex;

                // ì„ íƒ ìƒíƒœ ì—…ë°ì´íŠ¸
                document.querySelectorAll('.color-circle').forEach(c => c.classList.remove('selected'));
                this.classList.add('selected');

                // íŒ”ë ˆíŠ¸ ë‹«ê¸°
                document.getElementById('colorPalette').style.display = 'none';
            });
        });

        // ëª¨ë‹¬ ì™¸ë¶€ í´ë¦­ì‹œ íŒ”ë ˆíŠ¸ ë‹«ê¸°
        document.addEventListener('click', function (e) {
            const colorSelector = document.querySelector('.color-selector');
            if (!colorSelector.contains(e.target)) {
                document.getElementById('colorPalette').style.display = 'none';
            }
        });

        // ë°˜ë³µ ì„¤ì • ì´ë²¤íŠ¸ ë¦¬ìŠ¤ë„ˆ
        document.getElementById('repeatType').addEventListener('change', function () {
            const customSettings = document.getElementById('customSettings');

            if (this.value === 'custom') {
                customSettings.classList.remove('hidden');
                initializeCustomSettings();
            } else {
                customSettings.classList.add('hidden');
            }

            generateRRule();
        });

        // ì‚¬ìš©ì ì •ì˜ ì„¤ì • ì´ë²¤íŠ¸ë“¤
        document.getElementById('customInterval').addEventListener('input', generateRRule);
        document.getElementById('customFreq').addEventListener('change', function () {
            updateWeekdayVisibility();
            generateRRule();
        });

        // ìš”ì¼ ì„ íƒ
        document.querySelectorAll('.weekday-option').forEach(day => {
            day.addEventListener('click', function () {
                this.classList.toggle('selected');
                generateRRule();
            });
        });

        // ì¢…ë£Œ ì¡°ê±´
        document.querySelectorAll('input[name="customEndType"]').forEach(radio => {
            radio.addEventListener('change', function () {
                updateEndFields();
                generateRRule();
            });
        });

        document.getElementById('customUntilDate').addEventListener('change', generateRRule);
        document.getElementById('customCount').addEventListener('input', generateRRule);

        // í•˜ë£¨ ì¢…ì¼ ì²´í¬ë°•ìŠ¤ ì´ë²¤íŠ¸
        document.getElementById('allDayEvent').addEventListener('change', function () {
            const startDateInput = document.getElementById('eventStartDate');
            const endDateInput = document.getElementById('eventEndDate');
            const startDateTimeInput = document.getElementById('eventStartDateTime');
            const endDateTimeInput = document.getElementById('eventEndDateTime');

            if (this.checked) {
                // í•˜ë£¨ ì¢…ì¼: ë‚ ì§œë§Œ
                startDateInput.style.display = 'block';
                endDateInput.style.display = 'block';
                startDateTimeInput.style.display = 'none';
                endDateTimeInput.style.display = 'none';

                // ë‚ ì§œ ê°’ ë™ê¸°í™”
                if (startDateTimeInput.value) {
                    startDateInput.value = startDateTimeInput.value.split('T')[0];
                }
                if (endDateTimeInput.value) {
                    endDateInput.value = endDateTimeInput.value.split('T')[0];
                }
            } else {
                // ì‹œê°„ í¬í•¨: ë‚ ì§œ+ì‹œê°„
                startDateInput.style.display = 'none';
                endDateInput.style.display = 'none';
                startDateTimeInput.style.display = 'block';
                endDateTimeInput.style.display = 'block';

                // ë‚ ì§œ+ì‹œê°„ ê°’ ë™ê¸°í™”
                if (startDateInput.value) {
                    const currentTime = startDateTimeInput.value ? startDateTimeInput.value.split('T')[1] : '09:00';
                    startDateTimeInput.value = `${startDateInput.value}T${currentTime}`;
                }
                if (endDateInput.value) {
                    const currentTime = endDateTimeInput.value ? endDateTimeInput.value.split('T')[1] : '10:00';
                    endDateTimeInput.value = `${endDateInput.value}T${currentTime}`;
                }
            }
        });

        // ì‹œì‘ì¼ ë³€ê²½ì‹œ ì¢…ë£Œì¼ ìë™ ì¡°ì • ë° ë°˜ë³µ í…ìŠ¤íŠ¸ ì—…ë°ì´íŠ¸
        document.getElementById('eventStartDate').addEventListener('change', function () {
            const endDateInput = document.getElementById('eventEndDate');
            if (!endDateInput.value || endDateInput.value < this.value) {
                endDateInput.value = this.value;
            }
            updateRepeatTexts(this.value);
            generateRRule();
        });

        // ì‹œì‘ ë‚ ì§œ+ì‹œê°„ ë³€ê²½ì‹œ ì¢…ë£Œ ë‚ ì§œ+ì‹œê°„ ìë™ ì¡°ì •
        document.getElementById('eventStartDateTime').addEventListener('change', function () {
            const endDateTimeInput = document.getElementById('eventEndDateTime');
            if (!endDateTimeInput.value || endDateTimeInput.value <= this.value) {
                const startDateTime = new Date(this.value);
                startDateTime.setHours(startDateTime.getHours() + 1);
                endDateTimeInput.value = startDateTime.toISOString().slice(0, 16);
            }
            updateRepeatTexts(this.value.split('T')[0]);
            generateRRule();
        });

        // ì¼ì • ì €ì¥
        document.getElementById('saveEvent').addEventListener('click', async function () {
            const title = document.getElementById('eventTitle').value.trim();
            const allDay = document.getElementById('allDayEvent').checked;
            const memo = document.getElementById('eventMemo').value.trim();
            const selectedColorEnum = document.getElementById('colorPreview').dataset.color;

            let startDate, endDate;

            if (!title) {
                alert('ì¼ì • ì œëª©ì„ ì…ë ¥í•´ì£¼ì„¸ìš”.');
                return;
            }

            if (allDay) {
                // í•˜ë£¨ ì¢…ì¼ ëª¨ë“œ
                const startDateValue = document.getElementById('eventStartDate').value;
                const endDateValue = document.getElementById('eventEndDate').value;

                if (!startDateValue) {
                    alert('ì‹œì‘ì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                if (!endDateValue) {
                    alert('ì¢…ë£Œì¼ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                if (endDateValue < startDateValue) {
                    alert('ì¢…ë£Œì¼ì€ ì‹œì‘ì¼ë³´ë‹¤ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                    return;
                }

                startDate = formatDateForAPI(startDateValue, true);
                endDate = formatDateForAPI(endDateValue, true);
            } else {
                // ì‹œê°„ í¬í•¨ ëª¨ë“œ
                const startDateTimeValue = document.getElementById('eventStartDateTime').value;
                const endDateTimeValue = document.getElementById('eventEndDateTime').value;

                if (!startDateTimeValue) {
                    alert('ì‹œì‘ ë‚ ì§œì™€ ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                if (!endDateTimeValue) {
                    alert('ì¢…ë£Œ ë‚ ì§œì™€ ì‹œê°„ì„ ì„ íƒí•´ì£¼ì„¸ìš”.');
                    return;
                }

                if (endDateTimeValue <= startDateTimeValue) {
                    alert('ì¢…ë£Œ ì‹œê°„ì€ ì‹œì‘ ì‹œê°„ë³´ë‹¤ ì´í›„ì—¬ì•¼ í•©ë‹ˆë‹¤.');
                    return;
                }

                startDate = formatDateForAPI(startDateTimeValue, false);
                endDate = formatDateForAPI(endDateTimeValue, false);
            }

            const eventData = {
                title: title,
                startDate: startDate,
                endDate: endDate,
                timeZone: 'Asia/Seoul',
                isAllDay: allDay,
                recurrence: buildRecurrenceArray(),
                description: memo || null,
                color: selectedColorEnum
            };

            try {
                let response;
                if (currentEvent) {
                    // ê¸°ì¡´ ì´ë²¤íŠ¸ ìˆ˜ì •
                    response = await apiRequest(`${API_BASE_URL}/${currentEvent.id}`, 'PUT', eventData);
                } else {
                    // ìƒˆ ì´ë²¤íŠ¸ ì¶”ê°€
                    response = await apiRequest(API_BASE_URL, 'POST', eventData);
                }

                // ìº˜ë¦°ë” ìƒˆë¡œê³ ì¹¨
                calendar.refetchEvents();
                closeModal();

                console.log('ì¼ì • ì €ì¥ ì„±ê³µ:', response);

            } catch (error) {
                console.error('ì¼ì • ì €ì¥ ì‹¤íŒ¨:', error);
            }
        });

        // ì¼ì • ì‚­ì œ
        document.getElementById('deleteEvent').addEventListener('click', async function () {
            if (currentEvent && confirm('ì´ ì¼ì •ì„ ì‚­ì œí•˜ì‹œê² ìŠµë‹ˆê¹Œ?')) {
                try {
                    await apiRequest(`${API_BASE_URL}/${currentEvent.id}`, 'DELETE');

                    // ìº˜ë¦°ë” ìƒˆë¡œê³ ì¹¨
                    calendar.refetchEvents();
                    closeModal();

                    console.log('ì¼ì • ì‚­ì œ ì„±ê³µ');

                } catch (error) {
                    console.error('ì¼ì • ì‚­ì œ ì‹¤íŒ¨:', error);
                }
            }
        });

        // íƒ­ ì „í™˜ ê¸°ëŠ¥
        const tabItems = document.querySelectorAll('.tab-item');
        tabItems.forEach(tab => {
            tab.addEventListener('click', function () {
                tabItems.forEach(t => t.classList.remove('active'));
                this.classList.add('active');
            });
        });

        // ì´ˆê¸° RRULE ìƒì„±
        generateRRule();
    });
</script>
</body>
</html>